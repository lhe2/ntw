---
title: "fertility analyses"
date: "2024-02-15"
---

purpose: looking at fertility stats

*roadmap:*
0. load data, pckgs
1. ...

*questions:*
- fertility
  - overall hatch rates per trt/tent? factors contributing to hatch rates?
  - which trts lead to hatching?
  - controls: how do expt compare to controls?
  - daily avg hatch rate
  - running avg of egg production
  - time btwn coll vs hatching?
  - sex diffs?

- longevity
  - time to ec? what are contributing factors?
  - survival post ec? what factors? (affected by time in 4C?)

# 0. load data, helper fns
```{r}
source("./helpers_tents.R")
# map(other_helpers, ~discard(., .p = ~all))
  # working on it: https://stackoverflow.com/questions/63533428/in-r-remove-list-of-list-based-on-name
```
# 1. analyses hodgepodge

## A. overall hatch rates

```{r calc stats & add other filter criteria}
summ_hatch <- data_tstats %>%
  group_by(#id.tent,
           trt.f, trt.m, pop
           ) %>%
  summarise(n.tents = n_distinct(id.tent),
            n.collected = sum(n.coll, na.rm = TRUE),
            se.coll = sd(na.omit(n.coll))/sqrt(length(na.omit(n.coll))),
            n.hatched = sum(n.tothatch, na.rm = TRUE),
            se.hatched = sd(na.omit(n.tothatch))/sqrt(length(na.omit(n.tothatch))),
            n.females = sum(n.new.f, na.rm = TRUE),
            #start = first(jdate), end = last(jdate),
            t.duration = max(jdate) - min(jdate),
            rate.hatch = n.hatched/n.collected,
            se.hatch = sqrt(rate.hatch*(1-rate.hatch)/n.collected),  # check ???
            rate.f = round(n.collected/n.females, digits = 1)
            ) %>%
  drop_na(trt.m) %>% # drop tents w/o males
  mutate(trt.pair = case_when(trt.f < 400 & trt.f == trt.m ~ "ct F + ct M",
                              trt.f > 400 & trt.f == trt.m ~ "hs F + hs M",
                              trt.f < trt.m ~ "ct F + hs M",
                              trt.f > trt.m ~ "hs F + ct M",
                              TRUE ~ "err"),
         min.f = case_when(trt.f == 260 | trt.f == 426 ~ 26,
                            trt.f == 419 ~ 19,
                            trt.f == 433 ~ 33), 
         min.m = case_when(trt.m == 260 | trt.m == 426 ~ 26,
                            trt.m == 419 ~ 19,
                            trt.m == 433 ~ 33),
         trt.parent = case_when(trt.f == 260 & trt.m == 260 ~ 260,
                                trt.f == 419 | trt.m == 419 ~ 419,
                                trt.f == 426 | trt.m == 426 ~ 426,
                                trt.f == 433 | trt.m == 433 ~ 433),
         trt.combo = paste0(trt.f, "-", trt.m),
         min.combo = paste0(min.f, "-", min.m))

# idk if im doing se of a proportion correctly (per meggan's graphs)
  # https://stats.stackexchange.com/questions/266442/standard-error-for-proportion-with-small-sample-size

```

### - plots

```{r}
#RYB <- c("#324DA0", "#acd2bb", "#f1c363", "#a51122")

summ_hatch %>%
  filter(#pop == "lab" & 
           (trt.pair == "ct F + ct M" | trt.pair == "hs F + hs M")) %>%
  ggplot(aes(y = rate.hatch, x = n.collected, color = trt.combo, fill = trt.pair, shape = pop)) +
  geom_point(size = 2.5) +
  y_err_hrate(err = 50) + 
  #x_err_ncoll(0.005) + # not worth including lol
  theme_bw() +
  scale_color_manual(labels = c("260-260" = "26 (26C day)",
                                "419-419" = "19",
                                "426-426" = "26 (40C day)",
                                "433-433" = "33"), 
                     values = RYB) +
  # scale_shape_manual(values = c(21, 23)) +
  #scale_shape_manual(values = c(1, 16)) + # revisit this lol i give up
  scale_shape_manual(values = c(16, 18)) + 
  # scale_fill_manual(values = c("white", "black"),
  #                   labels = c("ct F + ct M" = "control (26C day)",
  #                              "hs F + hs M" = "exptl (40C day)")) +
  labs(title = "within trt hatch rates",
       y = "hatch proportion",
       x = "total eggs",
       color = "parent min temp",
       shape = "population",
       #fill = "parent trt"
       ) +
  guides(fill = "none") +
  ylim(c(0,0.25))
  
summ_hatch %>%
  filter(pop == "lab" & (trt.pair == "ct F + hs M" | trt.pair == "hs F + ct M")) %>%
  ggplot(aes(y = rate.hatch, x = n.collected, color = as.factor(trt.parent), shape = trt.pair)) +
  geom_point(size = 2) +
  y_err_hrate(err = 50) + 
  theme_bw() +
  scale_color_manual(values = c("#acd2bb", "#f1c363", "#a51122"),
                     labels = c("419" = "19",
                                "426" = "26",
                                "433" = "33")) +
  scale_shape_manual(values = c(15, 17),
                     labels = c("ct F + hs M" = "exptl M", 
                                "hs F + ct M" = "exptl F")) +
  labs(title = "lab: exptl F/M hatch rates",
       y = "hatch proportion",
       x = "total eggs",
       color = "parental min temp (C)",
       shape = "parent trt") +
  ylim(c(0,0.25))  

# summ_hatch %>%
#   filter(pop == "field") %>%
#   ggplot(aes(y = rate.hatch, x = n.collected, color = trt.combo, shape = trt.pair)) +
#   geom_point(size = 2) +
#   theme_bw() +
#   scale_color_manual(labels = c("260-260" = "26 (26C day)",
#                                 "419-419" = "19",
#                                 "426-426" = "26 (40C day)",
#                                 "433-433" = "33"), 
#                      values = RYB) +
#   scale_shape_manual(values = c(1, 16),
#                      labels = c("ct F + ct M" = "control (26C day)", 
#                                 "hs F + hs M" = "exptl (40C day)")) +
#   labs(title = "field: within trt hatch rates",
#        y = "hatch proportion",
#        x = "total eggs",
#        color = "parent min temp (C)",
#        shape = "trt conditions") +
#   ylim(c(0,0.25))

summ_hatch %>%
  filter(rate.hatch > 0) %>%
  ggplot(aes(y = rate.hatch, x = n.collected, color = as.factor(trt.parent), shape = trt.pair)) +
  geom_point(size = 2) +
  y_err_hrate(err = 50) + 
  theme_bw() +
  scale_color_manual(values = c("#324DA0", "#acd2bb", "#a51122"),
                     labels = c("260" = "26 (ctrl)",
                                "419" = "19",
                                "433" = "33")) +
  scale_shape_manual(values = c(1, 17, 16),
                       labels = c("ct F + ct M" = "ctrl (26°C day)",
                                  "hs F + ct M" = "exptl F", 
                                  "hs F + hs M" = "exptl (40°C day)")) +
  labs(title = "lab: trts w/ hatchlings",
       y = "hatch proportion",
       x = "total eggs",
       color = "parental min temp (C)",
       shape = "parent trt") +
  ylim(c(0,0.25))  
```

### - modeling: hatch rates

```{r calc stats}
summ_hatchmod <- data_tstats %>%
  replace(is.na(.), 0) %>%
  group_by(id.tent) %>%
  mutate(jdate.rel = jdate - first(jdate)) %>%
  group_by(jdate.rel) %>%
  mutate(n.tothatch.pertent = sum(n.tothatch),
         n.coll.pertent = sum(n.coll)) %>%
  ungroup() %>%
  group_by(trt.f, trt.m, pop) %>%
  mutate(n.tothatch.overall = sum(n.tothatch),
         n.coll.overall = sum(n.coll),
         #n.duration.overall = jdate-first(jdate)
         ) %>%
  filter(n.tothatch.overall > 0)
  
```

trying a bunch!

```{r}
mod.hatch <- glm(n.tothatch.overall ~ 
                   as.factor(trt.f) + as.factor(trt.m) + #pop +
                   n.coll.pertent,
                 data = summ_hatchmod,
                 family = poisson)
  # Warning: glm.fit: fitted rates numerically 0 occurred

# unfiltered:
summary(mod.hatch) # (***) for trt.f = 419, 433; (*) for n.coll.pertent. AIC = 12347
anova(mod.hatch) # nothing matters zzzzzz

# filtered:
summary(mod.hatch) # (***) for all trts. AIC = 1055.7
anova(mod.hatch) # nothing matters!
```
try dropping `n.coll` from the model

```{r}
mod.hatch2 <- glm(n.tothatch.overall ~ 
                   as.factor(trt.f) + as.factor(trt.m) 
                  #+ pop
                  ,
                 data = summ_hatchmod,
                 family = poisson)
  # Warning: glm.fit: fitted rates numerically 0 occurred

# unfiltered:
summary(mod.hatch2) # AIC = 12350 (very slightly worse...)
anova(mod.hatch2) # nothing matters still 👍

# filtered:
summary(mod.hatch2) # AIC = 1053.7 (slightly better model)
anova(mod.hatch2) # nothin matters!!!
```

look at random effects: 

```{r}
mod.hatch3 <- lme4::lmer(n.tothatch.overall ~ 
                           as.factor(trt.f) + as.factor(trt.m) + #pop +
                           #n.coll.pertent + 
                           (1|id.tent),
                         data = summ_hatchmod,
                         #family = poisson
                         )
  # doesnt work w/ unfiltered data: 
    # "Error in eval_f(x, ...) : Downdated VtV is not positive definite"
  # w/ filtered: model fails to converge

summary(mod.hatch3) # res = 1e-27, # obs = 166, # id.tent grps = 11
anova(mod.hatch3) # nothin matters!!!
```


## B. daily laying rate

### - calcs
```{r calculate}
# calculate # of currently ovipositing females
summ_rate <- data_tstats %>%
  mutate_at(c(6:13), ~replace_na(., 0)) %>%
  group_by(id.tent) %>%
  mutate(jdate.rel = jdate - first(jdate)) %>%
  ungroup() %>%
  group_by(id.tent, trt.f, trt.m, pop, trt.type, jdate.rel) %>%
  arrange(jdate.rel, .by_group = TRUE) %>%
  mutate(#n.laying = n.curr.f + n.died.f, .after = "n.curr.f",
         n.lay = dplyr::lag(n.curr.f, default = first(n.curr.f)) + n.died.f, .after = "n.curr.f") %>%
  ungroup()
  # mutate_at(n.laying == 0 & n.coll > 0, "n.laying" = lag(n.laying))
  # summarise()

# where n.ovipositing females = 0 but n.collected > 0, add the # collected to the day before
# first, figure out the rows
cond <- (summ_rate$n.coll > 0 & summ_rate$n.lay == 0)
summ_rate %>%
  mutate(index = as.numeric(rownames(.)), .before = 1) %>%
  subset(cond | lead(cond) | lead(cond, n=2)) # %>%
  #View()
rm(cond)

# edit values
summ_rate$n.coll[c(55, 66, 73, 115, 152, 210)] <- 1
summ_rate$n.coll[c(56, 67, 75, 116, 153, 211)] <- 0

# calculate daily hatch rate per tent and per trt  

   # (moved to respective sections)
  # how to include se for rate? -- see meggan?

```
### - plot per tent

```{r}
summ_rate_pertent <- summ_rate %>%
  group_by(id.tent, trt.f, trt.m, pop, trt.type, jdate.rel) %>%
  summarise(rate.pertent = n.coll/n.lay,
            n.tents = n(),
            n.ovi.pertent = sum(n.lay)) %>%
  replace(is.na(.), 0) %>%
  mutate(trt.btwn = case_when(trt.f == trt.m & trt.f == 260 ~ 26-26,
                              trt.f == trt.m & trt.f == 419 ~ 40-19,
                              trt.f == trt.m & trt.f == 426 ~ 40-26,
                              trt.f == trt.m & trt.f == 433 ~ 40-33,
                              trt.f < trt.m ~ as.numeric(trt.m),
                              trt.f > trt.m ~ as.numeric(trt.f)))


summ_rate_pertent %>%
  filter((trt.type == "within" | trt.type == "ctrl")
         & pop == "lab"
         ) %>% 
  ggplot(aes(#lty = pop,
             x = jdate.rel, # custom cutoffs per trt?
             group = id.tent,
             color = as.factor(trt.f)
             )) +
  geom_point(aes(y = rate.pertent)) +
  geom_line(aes(y = rate.pertent)) +
  facet_wrap(#pop 
             ~ trt.f,
             ncol = 4, nrow = 2) + # custom scales for field?
  theme_bw() +
  labs(title = "within trt per tent egg laying rate",
       y = "# eggs laid/female",
       x = "days since tent setup",
       color = "treatment") +
  scale_color_manual(values = RYB,
                      labels = labels.wintrt)


summ_rate_pertent %>%
  filter(#trt.type == "ctrl" | 
           trt.type == "sex-m" | trt.type == "sex-f") %>% 
  ggplot(aes(#lty = pop,
             x = jdate.rel, # custom cutoffs per trt?
             group = id.tent,
             color = as.factor(trt.btwn)
             )) +
  geom_point(aes(y = rate.pertent)) +
  geom_line(aes(y = rate.pertent)) +
  facet_wrap(trt.type ~ trt.btwn,
             ncol = 3, nrow = 2
             ) + # custom scales for field?
  theme_bw() +
  labs(title = "btwn trt per tent egg laying rate",
       y = "# eggs laid/female",
       x = "days since tent setup",
       color = "treatment") +
  scale_color_manual(values =  c("#acd2bb", "#f1c363", "#a51122"),
                      labels = labels.btwntrt)


```



### - plot trt overall
```{r plotting trt overall}
# summ_rate %>%
#   group_by(trt.f, trt.m, pop, jdate.rel) %>%
#   summarise(rate.overall = n.coll/n.lay)

summ_rate_overall <- summ_rate_pertent %>%
  group_by(trt.f, trt.m, pop, trt.type, jdate.rel) %>%
  arrange(jdate.rel, .by_group = TRUE) %>%
  summarise(rate.overall = mean(rate.pertent),
            n.tents = n(),
            n.ovi.overall = sum(n.ovi.pertent)) %>%
    replace(is.na(.), 0) %>%
  mutate(trt.pair = paste0(trt.f, "-", trt.m),
         label.facet = case_when(trt.f == 260 ~ "26-26",
                                 trt.f == 419 ~ "40-19",
                                 trt.f == 426 ~ "40-26",
                                 trt.f == 433 ~ "40-33"),
         trt.btwn = case_when(trt.f == trt.m & trt.f == 260 ~ 26-26,
                              trt.f == trt.m & trt.f == 419 ~ 40-19,
                              trt.f == trt.m & trt.f == 426 ~ 40-26,
                              trt.f == trt.m & trt.f == 433 ~ 40-33,
                              trt.f < trt.m ~ as.numeric(trt.m),
                              trt.f > trt.m ~ as.numeric(trt.f))
         #pop = factor(pop, levels = c("lab", "field"))
         )

# notes
  # need some more built in labels for the trt types... idk where to put that in tho
  # custom scale labels per layer: https://stackoverflow.com/questions/18394391/custom-legend-for-multiple-layer-ggplot
  
summ_rate_overall %>%
  filter(trt.type == "within" | trt.type == "ctrl") %>%
  ggplot(aes(x = jdate.rel, 
             lty = pop, 
             color = as.factor(trt.f) # want this to be RYB tho
             )) +
  facet_wrap(~ label.facet,
             nrow = 1) +
  geom_point(aes(y = rate.overall)) + 
  geom_line(aes(y = rate.overall)) +
  geom_line(aes(y = n.ovi.overall), color = "black", alpha = 0.55) +
  scale_linetype_manual(values = c("lab" = "solid", "field" = "dashed"),
                        #values = c("solid", "dashed")
                        ) +
  # scale_color_identity(name = "# females", guide = "legend") +
  theme_bw() +
  labs(title = "within treatment daily egg laying rate",
       y = "# eggs laid/female",
       x = "days since tent start"
       #color = 
         )

  
summ_rate_overall %>%
  filter(trt.type == "sex-f" | trt.type == "sex-m") %>%
  ggplot(aes(x = jdate.rel, 
             color = as.factor(trt.btwn) # want this to be RYB tho
             )) +
  facet_wrap(trt.type ~ trt.pair,
             nrow = 2, ncol = 3) +
  geom_point(aes(y = rate.overall)) + 
  geom_line(aes(y = rate.overall)) +
  geom_line(aes(y = n.ovi.overall), color = "black", alpha = 0.55) +
  scale_linetype_manual(values = c("lab" = "solid", "field" = "dashed"),
                        #values = c("solid", "dashed")
                        ) +
  # scale_color_identity(name = "# females", guide = "legend") +
  theme_bw() +
  labs(title = "btwn treatment daily egg laying rate",
       y = "# eggs laid/female",
       x = "days since tent start",
       color = "parent trt"
         )  
```
### - overlaid plots

```{r calc stats}
# test <- merge(summ_rate_overall, 
#          cbind(#summ_rate_pertent$id.tent, 
#                summ_rate_pertent$trt.f, summ_rate_pertent$trt.m, 
#                summ_rate_pertent$jdate.rel, summ_rate_pertent$pop, summ_rate_pertent$rate.pertent,
#                summ_rate_pertent$n.ovi.pertent), 
#          by = c("trt.f", "trt.m", "pop", "jdate.rel"), 
#          all = TRUE)

summ_rates_all <- summ_rate %>%
  group_by(id.tent, trt.f, trt.m, pop, trt.type, jdate.rel) %>%
  summarise(rate.pertent = n.coll/n.lay,
            #se.pertent = sd(na.omit(rate.pertent))/sqrt(n()),
            #se.pertent = sqrt(rate.pertent*(1-rate.pertent)/sum(n.lay)),
            n.tents.pertent = n(),
            n.ovi.pertent = sum(n.lay)) %>%
  replace(is.na(.), 0) %>%
  ungroup() %>% 
  group_by(trt.f, trt.m, pop, #trt.type, 
           jdate.rel) %>%
  #arrange(jdate.rel, .by_group = TRUE) %>%
  mutate(rate.overall = mean(rate.pertent),
         n.tents.overall = n(),
         n.ovi.overall = sum(n.ovi.pertent)
         #se.overall = sqrt(rate.overall*(1-rate.overall)/n.ovi.overall),
         #se.overall = sd(na.omit(rate.overall))/sqrt(n())
         ) %>%
  replace(is.na(.), 0) %>%
  ungroup() %>%
  mutate(trt.win = case_when(trt.f == trt.m & trt.f == 260 ~ "26-26",
                             trt.f == 419 ~ "40-19",
                             trt.f == 426 ~ "40-26",
                             trt.f == 433 ~ "40-33"),
         trt.btwn = case_when(#trt.f == trt.m & trt.f == 260 ~ "26-26",
           #trt.f == trt.m & trt.f == 419 ~ "40-19",
           #trt.f == trt.m & trt.f == 426 ~ "40-26",
           #trt.f == trt.m & trt.f == 433 ~ "40-33",
           trt.type == "ctrl" ~ 260,        
           trt.type == "sex-m" ~ as.numeric(trt.m),
           trt.type == "sex-f" ~ as.numeric(trt.f)
           #trt.f < trt.m ~ as.numeric(trt.m),
           #trt.f > trt.m ~ as.numeric(trt.f)
         )
  )
  
```


```{r testing facet_manual}
design <- "
abcd
#efg
" 

summ_rates_all %>%
  filter(trt.type == "ctrl" | trt.type == "within") %>%
  ggplot(aes(x = jdate.rel, color = trt.win 
             #group = id.tent
             )) +
  facet_grid(pop~trt.win,
             scales = "free_y"
             #rows = 2, cols  = 4
             ) +
  #geom_point(aes(y = rate.pertent), alpha = 0.5, show.legend = FALSE) +
  geom_line(aes(y = rate.pertent, group = id.tent), alpha= 0.25, show.legend = FALSE
            ) +
  geom_line(aes(y = rate.overall), show.legend = FALSE
            ) +
  geom_line(aes(y = n.ovi.overall), lty = "dashed", color = "black", alpha = 0.7) +
  theme_bw() +
  scale_color_manual(values = RYB) +
  scale_linetype_manual(values = c("solid", "dashed"), #idk how to get this to work
                        labels = c("lay rate", "# ovipositing females")) +
  labs(title = "within treatment hatch rates",
       y = "# eggs/female per day",
       x = "days since initial tent setup",
       lty = "rate")

```

```{r other attempt}
summ_rates_all %>%
  ungroup() %>%
  filter(trt.type == "ctrl" | trt.type == "sex-f" | trt.type == "sex-m") %>%
  ggplot(aes(x = jdate.rel, 
             color = as.factor(trt.btwn) # want this to be RYB tho
  )) +
  # facet_wrap(trt.type ~ trt.pair,
  #            nrow = 2, ncol = 3) +
  ggh4x::facet_manual(#~facet,
                      trt.type ~ trt.btwn,
                      design = design) +
  #geom_point(aes(y = rate.overall)) + 
  geom_line(aes(y = rate.pertent, group = id.tent), alpha = 0.3) +
  geom_line(aes(y = rate.overall)) +
  #geom_line(aes(y = n.ovi.overall), color = "black", alpha = 0.7, lty = "dashed") +
  # scale_linetype_manual(values = c("lab" = "solid", "field" = "dashed"),
  #                       #values = c("solid", "dashed")
  # ) +
  # scale_color_identity(name = "# females", guide = "legend") +
  scale_color_manual(values = RYB,
                     labels = labels.wintrt) +
  theme_bw() +
  labs(title = "btwn treatment daily egg laying rate",
       y = "# eggs laid/female per day",
       x = "days since tent start",
       color = "parent trt"
  )  

```
### - modeling: # collected

OOOOp big mistake. dont do this per day LOL (but prob at least overall tent duration?)

```{r get stats}
summ_eggmod <- data_tstats %>%
  mutate(room = as.factor(room),
         id.tent = as.factor(id.tent),
         trt.f = as.factor(trt.f),
         trt.m = as.factor(trt.m)) %>%
  group_by(id.tent, room, tent.loc, trt.f, trt.m, pop) %>%
  summarise(n.tents = n_distinct(id.tent),
            n.collected = sum(n.coll, na.rm = TRUE),
            n.hatched = sum(n.tothatch, na.rm = TRUE),
            n.females = sum(n.new.f, na.rm = TRUE),
            rate.hatch = n.hatched/n.collected,
            rate.f = round(n.collected/n.females, digits = 1))

```

```{r}
mod.coll <- glm(n.collected ~ trt.f + trt.m + pop + n.females, 
                data = summ_eggmod, family = poisson)

summary(mod.coll) # everything has an effect
anova(mod.coll) # lmao nothing is important tho!
```

- all the vars have a small but significant effect, but none of the variables matter
- AIC: 5235.5

drop the `n.females` bc idk if that matters tbh.... (it does)
```{r}
mod.coll2 <- glm(n.collected ~ trt.f + trt.m + pop, 
                data = summ_eggmod, family = poisson)

summary(mod.coll2)
anova(mod.coll2)
```
similar results, but AIC = 8073.5

look for random effects:

```{r}
mod.coll3 <- lme4::lmer(n.coll ~ trt.f + trt.m + n.curr.f + pop + (1|id.tent), 
                data = data_tstats, 
                #family = "poisson"
                )

summary(mod.coll3)
anova(mod.coll3)
```

with `lme4::lmer`, no major effects/no sig variables. residual for `id.tent` = 231

with `lmerTest::lmer`, `trt.f` is `*` and `curr.f` is `***` for both effect size and importance. residual for `id.tent` = 231 also


### - modeling: hatch rate

qns before going in: 
- what's the right response variable for this? (rate? overall eggs?)
  - and then, what factors? (depends on the level? overall or per tent? random effs?)
  
first pass mod: looking for relevant variables...

```{r warning=FALSE}
mod.lay <- glm(rate.overall ~ 
                 as.factor(trt.f) + #as.factor(trt.m) + 
                 pop + 
                 n.ovi.overall + n.tents.overall #+ jdate.rel
               ,
               data = summ_rates_all,
               family = poisson)
  # getting a TON of non-integer warnings lolol

summary(mod.lay) # everything matters (minorly) except trt.f = 900 and trt.m (***). AIC = Inf LOL
anova(mod.lay) # nothing matters!!
```
so we can probably drop the `trt.m` term which makes sense tbh! (bc `trt.m` shouldn't have an effect on if females lay lol). we can try it: 

```{r warning=FALSE}
mod.lay2 <- glm(rate.overall ~ 
                 as.factor(trt.f) + pop + 
                 n.ovi.overall + n.tents.overall #+ jdate.rel
                ,
               data = summ_rates_all,
               family = poisson)
  # getting a TON of non-integer warnings again

summary(mod.lay2) # everything matters (minorly) except trt.f = 900. AIC = Inf
anova(mod.lay2) # nothing rlly matters again tho 🫠..
```

it's hard to say if this model is rlly that meaningful since there's no AIC info... anyway. time to add in some random effects:

```{r}
mod.lay3 <- lme4::lmer(rate.overall ~ 
                        as.factor(trt.f) + as.factor(trt.m) + pop + 
                        n.ovi.overall + n.tents.overall + 
                         #jdate.rel +
                        (1|id.tent),
                      data = summ_rates_all,
                      )

summary(mod.lay3) # residual = 109 over 434 obs and 35 tent groups
anova(mod.lay3) # also nothing matters 👍
```




# to do

- better overlaid overall/per tent rate plots (fix # ovi females)
- fix mods: need to not batch by jdate lol
