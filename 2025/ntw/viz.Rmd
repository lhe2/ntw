---
title: "ntw 2025 data viz"
date: "2025-12-01"
---

# # preamble & loading

data viz for ntw 2025

```{r}
# libraries
library(tidyverse)
# library(survival) # for fitting 
# library(survminer) # for plotting

# pathfinding
here::i_am("2025/ntw/data-viz.Rmd")
library(here)

source(here::here("set-paths.R"))
source(here(bin_paths$y25$ntw, "utils.R")) # helper functions
```

```{r}
# data import
load(here(bin_paths$y25$ntwdata, "wrangle.RData"))
```

# # overall dev

## survival
```{r}
dfs_ss$surv_outcomes %>%
  FilterLabTB() %>%
  ggplot(aes(y = prop.pup,
             x = as.factor(trt),
             col = as.factor(year),
             lty = as.factor(year),
             group = year)) +
  geom_point() +
  geom_line() +
  facet_wrap(~pop) +
  labs(y = "survived to pupation",
       x = "treatment",
       col = "year", lty = "year") +
  #scale_color_brewer(palette = "Greens") +
  theme_bw()
```

## development
```{r}
# by year
dfs_ss$dev_outcomes_nopmd %>%
  FilterLabTB() %>% 
  filter(instar %in% c("3rd", "4th", "5th", "wander")) %>% #View()
  ggplot(aes(y = avg.logmass,
             x = avg.tt,
             col = as.factor(year))) +
  geom_point() +
  geom_line() +
  # hard to see with these lol bc theyre pretty close
  # geom_errorbar(aes(ymax = avg.logmass + se.logmass,
  #                   ymin = avg.logmass - se.logmass,
  #                   width = autoerr(avg.tt))) +
  # geom_errorbarh(aes(xmax = avg.tt + se.tt,
  #                    xmin = avg.tt - se.tt,
  #                    height = autoerrh(avg.logmass))) +
  facet_grid(pop ~ trt) +
  labs(title = "development trajectories (pup only)",
       caption = "mean ± se",
       y = "log(mass mg)", x = "dev time (days)",
       col = "year",
       ) +
  #scale_color_brewer(palette = "Greens") +
  theme_bw()


dfs_ss$dev_outcomes_pmd %>%
  FilterLabTB() %>% 
  filter(instar %in% c("3rd", "4th", "5th", "wander")) %>% #View()
  ggplot(aes(y = avg.logmass,
             x = avg.tt,
             col = as.factor(year))) +
  geom_point() +
  geom_line() +
  # hard to see with these lol bc theyre pretty close
  geom_errorbar(aes(ymax = avg.logmass + se.logmass,
                    ymin = avg.logmass - se.logmass,
                    width = autoerr(avg.tt))) +
  geom_errorbarh(aes(xmax = avg.tt + se.tt,
                     xmin = avg.tt - se.tt,
                     height = autoerrh(avg.logmass))) +
  facet_grid(pop ~ trt) +
  labs(title = "development trajectories (all)",
       caption = "mean ± se",
       y = "log(mass mg)", x = "dev time (days)",
       col = "year",
       ) +
  #scale_color_brewer(palette = "Greens") +
  theme_bw()
```

```{r}
# by trt
dfs_ss$dev_outcomes_nopmd %>%
  FilterLabTB() %>% 
  filter(instar %in% c("3rd", "4th", "5th", "wander")) %>% 
  ggplot(aes(y = avg.logmass,
             x = avg.tt,
             col = as.factor(trt))) +
  geom_point() +
  geom_line() +
  # hard to see with these lol bc theyre pretty close
  # geom_errorbar(aes(ymax = avg.logmass + se.logmass,
  #                   ymin = avg.logmass - se.logmass,
  #                   width = autoerr(avg.tt))) +
  # geom_errorbarh(aes(xmax = avg.tt + se.tt,
  #                    xmin = avg.tt - se.tt,
  #                    height = autoerrh(avg.logmass))) +
  facet_grid(pop ~ year) +
  labs(title = "development trajectories (pup only)",
       caption = "mean ± se",
       y = "log(mass mg)", x = "dev time (days)",
       col = "treatment",
       ) +
  #scale_color_brewer(palette = "Greens") +
  theme_bw()


dfs_ss$dev_outcomes_pmd %>%
  FilterLabTB() %>% 
  filter(instar %in% c("3rd", "4th", "5th", "wander")) %>% 
  ggplot(aes(y = avg.logmass,
             x = avg.tt,
             col = as.factor(trt))) +
  geom_point() +
  geom_line() +
  # hard to see with these lol bc theyre pretty close
  # geom_errorbar(aes(ymax = avg.logmass + se.logmass,
  #                   ymin = avg.logmass - se.logmass,
  #                   width = autoerr(avg.tt))) +
  # geom_errorbarh(aes(xmax = avg.tt + se.tt,
  #                    xmin = avg.tt - se.tt,
  #                    height = autoerrh(avg.logmass))) +
  facet_grid(pop ~ year) +
  labs(title = "development trajectories (all)",
       caption = "mean ± se",
       y = "log(mass mg)", x = "dev time (days)",
       col = "treatment",
       ) +
  #scale_color_brewer(palette = "Greens") +
  theme_bw()
```



## supernumerary
```{r}
dfs_ss$sup_outcomes %>% 
  FilterLabTB() %>%
  filter(status == "surv") %>%
  ggplot(aes(y = p,
             x = interaction(trt),
             fill = sup)) +
  geom_col() +
  geom_text(data = . %>% distinct(interaction(year, trt, pop), .keep_all = TRUE), 
            aes(label = N), y = 0.1) +
  facet_grid(pop~year) +
  labs(y = "proportion survived", x = "trt",
       fill = "fate",
       caption = "N = total entered") +
  guides(x = guide_axis(angle = 45)) +
  scale_fill_brewer(palette = "Blues", direction = -1) +
  theme_bw()
```

