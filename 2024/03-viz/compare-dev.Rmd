---
title: "ntw 2023 v 2024 comparisons data viz"
date: "2024-10-08"
---

# - setup

goal: compare 2023 and 2024 ntw development data. 

wip: need to do fertility data...

```{r}
here::i_am("2024/03-viz/compare-dev.Rmd")
library(here)

library(tidyverse)
library(patchwork)

source(here::here("set-paths.R"))
source(here::here(bin_paths24$wrangle, "compare-dev_p.R"))
source(here::here(bin_paths24$doviz, "aesthetics_util.R"))
```

troubleshooting ref

```{r}
# fig troubleshooting
# filter(all_wide, year == 2023 & sex == "f" & !is.na(tt.surv)) %>% View()
# filter(ntw_wide, year == 2023 & sex == "f" & !is.na(tt.surv)) %>% View()
# filter(ntw_wide, year == 2023 & sex == "f" & pop == "field" & minT == 33) %>% View()
# filter(ss_ntw, year == 2023 & sex == "f" & stage == "ad") %>% View()
```

# pupal survival

// todo
2025-01-23: 
- make these functions also LOL

```{r}
# NTs on pupal survival 

p1 <- ss_ntw %>% 
  filter(stage == "la" & trt.type == "expt") %>% 
  ggplot(aes(y = prop.survpup, x = minT,
             color = stage, 
             lty = pop, shape = year,
             group = interaction(pop, trt.type))) +
  geom_line() +
  geom_point(size = 2) +
  geom_text(aes(label = n.dev), hjust = -0.25, vjust = -0.5) +
  labs(x = "minimum temperature (°C)") +
  facet_wrap(~year) +
  theme_bw()

p1


p2 <- ss_ntw %>% 
  filter(stage == "la" & trt.type == "ctrl") %>% 
  mutate(trt.type = "control (26/26 °C)") %>%
  ggplot(aes(y = prop.survpup, x = year,
             color = stage, 
             lty = pop, shape = year,
             group = interaction(pop, trt.type))) +
  geom_line() +
  geom_point(size = 2) +
  geom_text(aes(label = n.dev), hjust = -0.25, vjust = -0.5) +
  facet_wrap(~trt.type) +
  theme_bw()

p2

# merge
p1 + p2 +
  labs(caption = "do lower NTs increase survival to pup?") +
  plot_layout(guides = "collect",
              axes = "collect",
              widths = c(2:1)) &
  theme(legend.position = "top") &
  labs(lty = "population",
       y = "proportion survived to pupation") &
  guides(color = "none") &
  scale_linetype_manual(values = c("dashed", "solid")) &
  scale_shape_manual(values = c(1, 16)) &
  scale_color_manual(values = "#1B9E77") &
  ylim(c(0, 1))

```


# dev outcomes (sup)

## - pmds + pups

```{r}
# not stacking stages/grouping by pop as desired
ss_devall2 %>%
  ggplot(aes(y = p, x = trt, fill = stage)) +
  #geom_col(position = "dodge") + facet_wrap(~year) +
  #geom_col() + facet_wrap(year~pop) +
  geom_col(position = "dodge", stat = "identity") + facet_wrap(~year) +
  labs(caption = "pmds + dev fates of pups") +
  theme_bw()

# okay apparently u just cant stack AND dodge at the same time lol says google
  # https://stackoverflow.com/questions/12715635/ggplot2-bar-plot-with-both-stack-and-dodge
  # https://stackoverflow.com/questions/46597278/how-to-plot-a-stacked-and-grouped-bar-chart-in-ggplot
ss_devall2 %>%
  ggplot(aes(y = p, x = interaction(pop, trt), fill = stage)) +
  geom_bar(position = "stack", stat = "identity") + facet_grid(~year) +
  #geom_col() + facet_wrap(year~pop) +
  labs(caption = "pmds + dev fates of pups") +
  theme_bw()

# this is the one!!!!!
ss_devall2 %>%
  ggplot(aes(y = p, x = interaction(pop, trt), fill = stage)) +
  geom_bar(position = "stack", 
           #position = position_fill(reverse = TRUE),
           stat = "identity") + 
  facet_grid(~interaction(pop,year), scale = "free", 
             #labeller = as_labeller(interaction(pop,year) = c("field 2023", "lab 2023", "field 2024", "lab 2024"))
             ) +
  #geom_col() + facet_wrap(year~pop) +
  labs(caption = "pmds + instars of pups",
       fill = "stage",
       x = "D-N treatment (°C)",
       y = "proportion") +
  scale_x_discrete(labels = c("26-26", "40-19", "40-26", "40-33"), guide = guide_axis(angle = 45)) +
  #theme(axis.text.x.bottom = element_text(angle = 90)) +
  scale_fill_brewer(palette = "Blues", direction = -1) +
  theme_bw()
  

# trying w/ alpha.. tldr i think i need to combine some of these variables tgt lol. but also redo the math
# (its not adding to 1 bc need x=interaction)
ss_devall2 %>%
  ggplot(aes(y = p, x = pop, fill = stage, group = trt, alpha = trt)) +
  geom_bar(position = "dodge", stat = "identity") + facet_grid(~year) +
  #geom_col() + facet_wrap(year~pop) +
  labs(caption = "pmds + dev fates of pups") +
  theme_bw()
```

## - pups only

```{r}
# looking only at survivors
ss_devpmd2 %>%
  ggplot(aes(y = p, x = interaction(pop, trt), fill = stage)) +
  geom_bar(position = "stack", 
           #position = position_fill(reverse = TRUE),
           stat = "identity") + 
  facet_grid(~interaction(pop,year), scale = "free", 
             #labeller = as_labeller(interaction(pop,year) = c("field 2023", "lab 2023", "field 2024", "lab 2024"))
             ) +
  #geom_col() + facet_wrap(year~pop) +
  labs(caption = "instars of things that survived to pupation",
       fill = "stage",
       x = "D-N treatment (°C)",
       y = "proportion") +
  scale_x_discrete(labels = c("26-26", "40-19", "40-26", "40-33"), guide = guide_axis(angle = 45)) +
  #theme(axis.text.x.bottom = element_text(angle = 90)) +
  scale_fill_brewer(palette = "Blues", 
                    #direction = -1
                    ) +
  theme_bw()
```


# dev time & longevity

// todo
- 2025-01-30: look into forcing y-axes limits to be the same w `ggh4x`
  - https://teunbrand.github.io/ggh4x/articles/Facets.html
  
## - by sex

```{r}
# NTs on development time/longevity
# see this
  # https://stackoverflow.com/questions/78193007/how-do-i-control-the-alpha-of-a-geom-point-fill

p1 <- ss_ntw %>% 
  mutate(sex = case_when(is.na(sex) ~ "both",
                         TRUE ~ as.character(sex))) %>%
  filter(!(stage == "ad" & sex == "all")) %>%
  filter((stage == "la" | stage == "ad") & trt.type == "expt") %>% #View()
  ggplot(aes(y = avg.tt, x = minT,
             color = stage, #fill = stage, 
             shape = sex,
             group = interaction(pop, stage, sex)
             )) +
  geom_errorbar(aes(ymin = avg.tt - se.tt, ymax = avg.tt + se.tt), width = 0.25) +
  geom_line(aes(lty = pop), alpha = 1) +
  geom_point(aes(#alpha = year, 
                 color = stage), size = 2) +
  geom_text(aes(label = n), hjust = -0.25, vjust = -0.5, show.legend = FALSE) +
  #geom_point(fill = NA, size = 2) +
  labs(x = "minimum temperature (°C)") +
  facet_wrap(~year) + # orig
  # facet_grid(stage~year, scales = "free_y"
  #            ) +
  theme_bw()

p1


p2 <- ss_ntw %>% 
  mutate(sex = case_when(is.na(sex) ~ "both",
                         TRUE ~ as.character(sex))) %>%
  filter(!(stage == "ad" & sex == "all")) %>%
  filter((stage == "la" | stage == "ad") & trt.type == "ctrl") %>% 
  mutate(trt.type = "control (26/26 °C)") %>%
  ggplot(aes(y = avg.tt, x = year,
             color = stage, 
             #fill = stage, shape = sex,
             group = interaction(pop, stage, sex)
             )) +
  geom_errorbar(aes(ymin = avg.tt - se.tt, ymax = avg.tt + se.tt), width = 0.25) +
  geom_line(aes(lty = pop), alpha = 1) +
  #geom_point(aes(alpha = year), size = 2) +
  geom_text(aes(label = n), hjust = -0.25, vjust = -0.5, show.legend = FALSE) +
  geom_point(#fill = NA, 
             size = 2) +
  labs(x = "year") +
  facet_wrap(~trt.type) + # orig
  # facet_grid(stage~trt.type, scales = "free_y"
  #            ) +
  theme_bw()

p2

# merge
p1 + p2 +
  labs(caption = "do lower NTs reduce dev time?") +
  plot_layout(guides = "collect",
              axes = "collect",
              widths = c(2:1)) &
  theme(legend.position = "top") &
  labs(#lty = "population",
       y = "development time / longevity (days)") &
  #guides(color = "none") &
  scale_linetype_manual(values = c("dashed", "solid")) &
  scale_shape_manual(values = c(21, 24, 22)
                     #c(16, 17, 15)
                     #c(1, 2, 0)
                     ) &
  scale_color_manual(values = c("#1B9E77", "#7570B3")) &
  scale_fill_manual(values = c("#1B9E77", "#7570B3")) &
  theme(strip.background.y = element_blank(), strip.text.y = element_blank()) &
  expand_limits(y = 37)
  #scale_alpha_manual(values = c(0.1,1)) &
  #ylim(c(2.5, 35))

```

## - larva only (time to pup)

```{r}
p1 <- ss_ntw %>% 
  filter(stage == "la" & trt.type == "expt") %>% #View()
  ggplot(aes(y = avg.tt, x = minT,
             color = stage, 
             group = interaction(pop, stage)
             )) +
  geom_errorbar(aes(ymin = avg.tt - se.tt, ymax = avg.tt + se.tt), width = 0.25) +
  geom_line(aes(lty = pop), alpha = 1) +
  geom_point(aes(#alpha = year, 
                 color = stage), size = 2) +
  geom_text(aes(label = n), hjust = -0.25, vjust = -0.5, show.legend = FALSE) +
  #geom_point(fill = NA, size = 2) +
  labs(x = "minimum temperature (°C)") +
  facet_wrap(~year) + # orig
  # facet_grid(stage~year, scales = "free_y"
  #            ) +
  theme_bw()

p1


p2 <- ss_ntw %>% 
  filter(stage == "la" & trt.type == "ctrl") %>%
  mutate(trt.type = "control (26/26 °C)") %>%
  ggplot(aes(y = avg.tt, x = year,
             color = stage, 
             group = interaction(pop, stage)
             )) +
  geom_errorbar(aes(ymin = avg.tt - se.tt, ymax = avg.tt + se.tt), width = 0.25) +
  geom_line(aes(lty = pop), alpha = 1) +
  #geom_point(aes(alpha = year), size = 2) +
  geom_text(aes(label = n), hjust = -0.25, vjust = -0.5, show.legend = FALSE) +
  geom_point(#fill = NA, 
             size = 2) +
  labs(x = "year") +
  facet_wrap(~trt.type) + # orig
  # facet_grid(stage~trt.type, scales = "free_y"
  #            ) +
  theme_bw()

p2

# merge
p1 + p2 +
  labs(caption = "do lower NTs reduce pup dev time?") +
  plot_layout(guides = "collect",
              axes = "collect",
              widths = c(2:1)) &
  theme(legend.position = "top") &
  labs(#lty = "population",
       y = "development time (days)") &
  #guides(color = "none") &
  scale_linetype_manual(values = c("dashed", "solid")) &
  scale_color_manual(values = c("#1B9E77")) &
  scale_fill_manual(values = c("#1B9E77")) &
  theme(strip.background.y = element_blank(), strip.text.y = element_blank()) &
  ylim(c(15, 37))

```

## - 1/days by pop (bsft)

```{r}
# colored by pop
p1 <- ss_ntw %>% 
    mutate(n = case_when(stage == "la" ~ n.pup,
                       TRUE ~ n)) %>%
  filter(stage == "la" & z.type == "rate" & trt.type == "expt") %>%
  ggplot(aes(y = avg.tt, x = minT,
             color = pop, 
             group = interaction(pop, stage, trt.type)
             )) +
  geom_errorbar(aes(ymin = avg.tt - se.tt, ymax = avg.tt + se.tt), width = 0.25) +
  geom_line(aes(lty = pop), alpha = 1) +
  geom_point(aes(#alpha = year, 
                 color = pop), size = 2) +
  geom_text(aes(label = n), hjust = -0.25, vjust = -0.5, show.legend = FALSE) +
  #geom_point(fill = NA, size = 2) +
  labs(x = "minimum temperature (°C)") +
  #facet_wrap(~year) + # orig
  geom_text(aes(label = n), hjust = -0.25, vjust = -0.5, show.legend = FALSE) +
  facet_grid(~year, scales = "free_y") +
  theme_bw()

p1


p2 <- ss_ntw %>% 
  # rename(avg.tt2 = avg.devrate,
  #        se.tt2 = se.devrate) %>%
  mutate(n = case_when(stage == "la" ~ n.pup,
                       TRUE ~ n)) %>%
  filter(stage == "la" & z.type == "rate" & trt.type == "ctrl") %>%
  mutate(trt.type = "control (26/26 °C)") %>%
  ggplot(aes(y = avg.tt, x = year,
             color = pop, 
             group = interaction(pop, stage, trt.type)
             )) +
  geom_errorbar(aes(ymin = avg.tt - se.tt, ymax = avg.tt + se.tt), width = 0.25) +
  geom_line(aes(lty = pop), alpha = 1) +
  #geom_point(aes(alpha = year), size = 2) +
  geom_text(aes(label = n), hjust = -0.25, vjust = -0.5, show.legend = FALSE) +
  geom_point(#fill = NA, 
             size = 2) +
  labs(x = "year") +
  #facet_wrap(~trt.type) + # orig
  geom_text(aes(label = n), hjust = -0.25, vjust = -0.5, show.legend = FALSE) +
  facet_grid(~trt.type, scales = "free_y") +
  theme_bw()

p2

# merge
p1 + p2 +
  #labs(caption = "do lower NTs reduce pup dev time?") +
  plot_layout(guides = "collect",
              axes = "collect",
              widths = c(2:1)) &
  theme(legend.position = "top") &
  labs(lty = "population", color = "population",
       #y = "adult longevity | time to pupation (days)"
       y = "growth rate (1/days)"
       ) &
  guides(fill = "none") &
  scale_linetype_manual(values = c("dashed", "solid"), labels = c("field", "lab")) &
  #scale_shape_manual(values = c(19)) &
  scale_color_manual(values = c("#41b6c4", "#225ea8"), labels = c("field", "lab")) &
  #ylim(c(15, 37)) &
  theme(strip.background.y = element_blank(), strip.text.y = element_blank())

```

# mass (all stages)

## - by sex

```{r}
# NTs on pupal/adult mass

p1 <- ss_ntw %>% 
  mutate(sex = case_when(is.na(sex) ~ "both",
                         TRUE ~ as.character(sex))) %>%
  filter(!(stage == "ad" & sex == "all")) %>%
  filter((stage == "pu" | stage == "ad") & trt.type == "expt") %>% #View()
  ggplot(aes(y = avg.mass, x = minT,
             color = stage, #fill = stage, 
             shape = sex,
             group = interaction(pop, stage, sex)
             )) +
  geom_errorbar(aes(ymin = avg.mass - se.mass, ymax = avg.mass + se.mass), width = 0.25) +
  geom_line(aes(lty = pop), alpha = 1) +
  geom_point(aes(#alpha = year, 
                 color = stage), size = 2) +
  #geom_point(fill = NA, size = 2) +
  labs(x = "minimum temperature (°C)") +
  facet_grid(#stage
             ~year) +
  theme_bw()

p1

p2 <- ss_ntw %>% 
  mutate(sex = case_when(is.na(sex) ~ "both",
                         TRUE ~ as.character(sex))) %>%
  filter(!(stage == "ad" & sex == "all")) %>%
  filter((stage == "pu" | stage == "ad") & trt.type == "ctrl") %>% 
  mutate(trt.type = "control (26/26 °C)") %>%
  ggplot(aes(y = avg.mass, x = year,
             color = stage, #fill = stage, 
             shape = sex,
             group = interaction(pop, stage, sex)
             )) +
  geom_errorbar(aes(ymin = avg.mass - se.mass, ymax = avg.mass + se.mass), width = 0.25) +
  geom_line(aes(lty = pop), alpha = 1) +
  geom_point(#aes(alpha = year), 
             size = 2) +
  #geom_point(fill = NA, size = 2) +
  labs(x = "year") +
  facet_grid(#stage
               ~trt.type) +
  theme_bw()

p2

# merge
p1 + p2 +
  labs(caption = "do lower NTs lead to larger mass?") +
  plot_layout(guides = "collect",
              axes = "collect",
              widths = c(2:1)) &
  theme(legend.position = "top") &
  labs(#lty = "population",
       y = "mass (g)") &
  #guides(color = "none") &
  scale_linetype_manual(values = c("dashed", "solid")) &
  scale_shape_manual(values = c(24, 22)) &
  scale_color_manual(values = c("#D95F02", "#7570B3")) &
  scale_fill_manual(values = c("#D95F02", "#7570B3")) &
  #scale_alpha_manual(values = c(0.1,1)) &
  theme(strip.background.y = element_blank(), strip.text.y = element_blank()) &
  ylim(c(0.75, 7.25))

```

## - sexes combined

```{r}
# NTs on pupal/adult mass

p1 <- ss_ntw %>% 
  filter(sex == "all") %>%
  filter((stage == "pu" | stage == "ad") & trt.type == "expt") %>% #View()
  ggplot(aes(y = avg.mass, x = minT,
             color = stage, #fill = stage, 
             group = interaction(pop, stage)
             )) +
  geom_errorbar(aes(ymin = avg.mass - se.mass, ymax = avg.mass + se.mass), width = 0.25) +
  geom_line(aes(lty = pop), alpha = 1) +
  geom_point(aes(#alpha = year, 
                 color = stage), size = 2) +
  #geom_point(fill = NA, size = 2) +
  labs(x = "minimum temperature (°C)") +
  facet_grid(#stage
             ~year) +
  theme_bw()

p1

p2 <- ss_ntw %>% 
  filter(sex == "all") %>%
  filter((stage == "pu" | stage == "ad") & trt.type == "ctrl") %>% 
  mutate(trt.type = "control (26/26 °C)") %>%
  ggplot(aes(y = avg.mass, x = year,
             color = stage, #fill = stage, 
             group = interaction(pop, stage)
             )) +
  geom_errorbar(aes(ymin = avg.mass - se.mass, ymax = avg.mass + se.mass), width = 0.25) +
  geom_line(aes(lty = pop), alpha = 1) +
  geom_point(#aes(alpha = year), 
             size = 2) +
  #geom_point(fill = NA, size = 2) +
  labs(x = "year") +
  facet_grid(#stage
               ~trt.type) +
  theme_bw()

p2

# merge
p1 + p2 +
  labs(caption = "do lower NTs lead to larger mass?") +
  plot_layout(guides = "collect",
              axes = "collect",
              widths = c(2:1)) &
  theme(legend.position = "top") &
  labs(#lty = "population",
       y = "mass (g)") &
  #guides(color = "none") &
  scale_linetype_manual(values = c("dashed", "solid")) &
  scale_color_manual(values = c("#D95F02", "#7570B3")) &
  scale_fill_manual(values = c("#D95F02", "#7570B3")) &
  #scale_alpha_manual(values = c(0.1,1)) &
  theme(strip.background.y = element_blank(), strip.text.y = element_blank()) &
  ylim(c(0.75, 7.25))

```

# pupal mass

how does pup mass look across yrs, pops, trts, sexes, temps? (getting some intuition of what to do for modeling)

## - by sex

```{r}
# NTs on pupal mass

p1 <- ss_ntw %>% 
  filter(stage == "pu" & trt.type == "expt") %>% #View()
  ggplot(aes(y = avg.mass, x = minT,
             color = sex, shape = sex,
             group = interaction(pop, sex)
             )) +
  geom_errorbar(aes(ymin = avg.mass - se.mass, ymax = avg.mass + se.mass), width = 0.25) +
  geom_line(aes(lty = pop), alpha = 1) +
  geom_point(aes(color = sex), size = 2) +
  labs(x = "minimum temperature (°C)") +
  facet_grid(is.sep~year) +
  theme_bw()

p1

p2 <- ss_ntw %>% 
  filter(stage == "pu" & trt.type == "ctrl") %>% 
  mutate(trt.type = "control (26/26 °C)") %>%
  ggplot(aes(y = avg.mass, x = year,
             color = sex, shape = sex,
             group = interaction(pop, sex)
             )) +
  geom_errorbar(aes(ymin = avg.mass - se.mass, ymax = avg.mass + se.mass), width = 0.25) +
  geom_line(aes(lty = pop), alpha = 1) +
  geom_point(size = 2) +
  labs(x = "year") +
  facet_grid(is.sep~trt.type) +
  theme_bw()

p2

# merge
p1 + p2 +
  labs(caption = "do lower NTs lead to larger pupal mass?") +
  plot_layout(guides = "collect",
              axes = "collect",
              widths = c(2:1)) &
  theme(legend.position = "top") &
  labs(#lty = "population",
       y = "mass (g)") &
  #guides(color = "none") &
  scale_linetype_manual(values = c("dashed", "solid")) &
  scale_shape_manual(values = bin_aes$sexes$ptfill_all) &
  scale_color_manual(values = bin_aes$sexes$colall) &
  #scale_fill_manual(values = c("#D95F02", "#7570B3")) &
  theme(strip.background.y = element_blank(), strip.text.y = element_blank())

```

- what does/doesnt matter?
  - pop, field < lab
  - minT, interacting with lab
  - sex can prob be ignored

## - by pop (bsft)

```{r}
p1 <- ss_ntw %>% 
  filter(stage == "pu") %>%
  # mutate(sex = case_when(is.na(sex) ~ "both",
  #                        TRUE ~ as.character(sex))) %>%
  # filter(sex != "all") %>%
  filter(sex == "all") %>%
  filter(trt.type == "expt") %>%
  ggplot(aes(y = avg.mass, x = minT,
             color = pop, 
             #shape = sex,
             #group = interaction(pop, sex)
             group = pop
             )) +
  geom_errorbar(aes(ymin = avg.mass - se.mass, ymax = avg.mass + se.mass), width = 0.25) +
  geom_line(aes(lty = pop), alpha = 1) +
  geom_point(aes(#alpha = year, 
                 color = pop), size = 2) +
  #geom_point(fill = NA, size = 2) +
  labs(x = "minimum temperature (°C)") +
  facet_grid(#sex
             ~year, 
             #scales = "free_y"
             ) +
  geom_text(aes(label = n), hjust = -0.25, vjust = -0.5, show.legend = FALSE) +
  theme_bw()

p1

p2 <- ss_ntw %>% 
  filter(stage == "pu") %>%
  # mutate(sex = case_when(is.na(sex) ~ "both",
  #                        TRUE ~ as.character(sex))) %>%
  # filter(sex != "all") %>%
  filter(sex == "all") %>%
  filter(trt.type == "ctrl") %>% 
  mutate(trt.type = "control (26/26 °C)") %>%
  ggplot(aes(y = avg.mass, x = year,
             color = pop, 
             #shape = sex,
             #group = interaction(pop, sex),
             group = pop
             )) +
  geom_errorbar(aes(ymin = avg.mass - se.mass, ymax = avg.mass + se.mass), width = 0.25) +
  geom_line(aes(lty = pop), alpha = 1) +
  geom_point(#aes(alpha = year), 
             size = 2) +
  geom_text(aes(label = n), hjust = -0.25, vjust = -0.5, show.legend = FALSE) +
  labs(x = "year") +
  facet_grid(#sex
             ~trt.type, 
             #scales = "free_y"
             ) +
  theme_bw()

p2

# merge
p1 + p2 +
  #labs(caption = "do lower NTs lead to larger mass?") +
  plot_layout(guides = "collect",
              axes = "collect",
              widths = c(2:1)) &
  theme(legend.position = "top") &
  labs(lty = "population",
       color = "population",
       y = "pupal mass (g)",
       ) &
  #guides(fill = "none") &
  scale_linetype_manual(values = c("dashed", "solid"), labels = c("field", "lab")) &
  #scale_shape_manual(values = c(17, 15)) &
  scale_shape_manual(values = c(16, 1)) &
  scale_color_manual(values = c("#41b6c4", "#225ea8"), labels = c("field", "lab")) & 
  #scale_fill_manual(values = c("#41b6c4", "#225ea8")) &
  #ylim(c(0.75, 7.25)) &
  ylim(c(2.1, 6.8)) &
  theme(strip.background.y = element_blank(), strip.text.y = element_blank())
```


# dmass

## - check decrease (R^2)

is decrease in mass from pup to ec proportional?

```{r}
summary(lm(mass.eclose ~ mass.pupa, data = filter(ntw_wide, !(diet == "TB" & pop == "lab") & trt.type == "expt")))$r.squared
# 0.5518755

summary(lm(mass.eclose ~ mass.pupa, data = filter(ntw_wide, !(diet == "TB" & pop == "lab") & trt.type == "ctrl")))$r.squared
# 0.6266585

summary(lm(mass.eclose ~ mass.pupa, data = filter(ntw_wide, !(diet == "TB" & pop == "lab"))))$r.squared
# 0.7310885
```

```{r}
ntw_wide %>%
  filter(!is.na(sex)) %>%
  filter(!(diet == "TB" & pop == "lab") #& trt.type == "expt"
         ) %>%
  filter(trt.type == "expt") %>%
  ggplot(aes(y = mass.eclose, x = mass.pupa, 
             #lty = sex
             )) +
  geom_point(aes(color = minT, shape = trt.type), size = 2) +
  # geom_smooth(data = filter(ntw_wide, !(diet == "TB" & pop == "lab") & trt.type == "expt"),
  #             method = "lm",
  #             color = "red") +
  # annotate("text", label = "R^2 = 0.552", color = "red", x = 1100, y = 4500) +
  geom_smooth(data = filter(ntw_wide, !(diet == "TB" & pop == "lab") & trt.type == "ctrl"),
              method = "lm",
              color = "black") +
  annotate("text", label = "R^2 = 0.627 (26-26)", color = "black", x = 1100, y = 4250) +
  geom_smooth(method = "lm", color = "blue",
              #aes(lty = trt.type)
              ) +
  annotate("text", label = "R^2 = 0.731 (all)", color = "blue", x = 1100, y = 4000) +
  theme_bw() +
  scale_color_manual(values = bin_aes$pals$col3) +
  labs(caption = "mass pup vs mass eclosion") +
  #facet_wrap(~trt.type) +
  xlim(c(500, 8100))

```

seems like yes (in both the ctrls and exptal bugs)


## - check decrease (slope)

```{r}
# expt NTs only
coef(lm(mass.eclose ~ mass.pupa , data = filter(ntw_wide, minT == 19)))[2] # 0.392141
coef(lm(mass.eclose ~ mass.pupa , data = filter(ntw_wide, minT == 26 & trt.type == "expt")))[2] # 0.4787052 
coef(lm(mass.eclose ~ mass.pupa , data = filter(ntw_wide, minT == 33)))[2] #  0.285198 

# ctrls, expts, all
coef(lm(mass.eclose ~ mass.pupa , data = filter(ntw_wide, trt.type == "ctrl")))[2] # 0.4372342
coef(lm(mass.eclose ~ mass.pupa , data = filter(ntw_wide, trt.type == "expt")))[2] # 0.4012044
coef(lm(mass.eclose ~ mass.pupa , data = ntw_wide))[2] # 0.428684
```

```{r}
ntw_wide %>%
  #filter(trt.type == "expt") %>%
  mutate(trt.type = factor(trt.type, levels = c("expt", "ctrl"))) %>%
  ggplot(aes(y = mass.eclose, x = mass.pupa, 
             col = minT, fill = minT,
             shape = trt.type, lty = trt.type)) +
  geom_point() +
  geom_smooth(data = filter(ntw_wide, trt.type == "expt"),
              method = "lm", alpha = 0.25,
              show.legend = FALSE) +
  theme_bw() +
  scale_color_manual(values = bin_aes$pals$col3) +
  scale_fill_manual(values = bin_aes$pals$col3) +
  annotate("text", x = 1500, y = 3750, label = "40-26 = 0.479", col = "#D95F02") +
  annotate("text", x = 1500, y = 3500, label = "26-26 = 0.437") +
  annotate("text", x = 1500, y = 3250, label = "all = 0.429") +
  annotate("text", x = 1500, y = 3000, label = "40-19 = 0.392", col = "#1B9E77") +
  annotate("text", x = 1500, y = 2750, label = "40-33 = 0.285", col = "#7570B3") +
  labs(caption = "mass pup vs mass eclosion (slopes of exptal groups)") 
```




## - by sex

```{r}
# separated sexes
p1 <- ss_moredev %>% 
  filter(sex != "both" & 
           trt.type == "expt") %>%
  ggplot(aes(y = avg.dmass, x = minT,
             shape = sex, color = sex,
             group = interaction(pop, sex)
             )) +
  geom_errorbar(aes(ymin = avg.dmass - se.dmass, ymax = avg.dmass + se.dmass), width = 0.25) +
  geom_line(aes(lty = pop), alpha = 1) +
  geom_point(size = 2) +
  geom_text(aes(label = n), hjust = -0.25, vjust = -0.5, show.legend = FALSE) +
  labs(x = "minimum temperature (°C)") +
  facet_grid(sex~year) +
  #scale_color_manual(values = aes_2col) +
  theme_bw()

p1

p2 <- ss_moredev %>% 
  filter(sex != "both" & 
           trt.type == "ctrl") %>%
  ggplot(aes(y = avg.dmass, x = year,
             shape = sex, color = sex,
             group = interaction(pop, sex)
             )) +
  geom_errorbar(aes(ymin = avg.dmass - se.dmass, ymax = avg.dmass + se.dmass), width = 0.25) +
  geom_line(aes(lty = pop), alpha = 1) +
  geom_point(size = 2) +
  geom_text(aes(label = n), hjust = -0.25, vjust = -0.5, show.legend = FALSE) +
  labs(x = "year") +
  facet_grid(sex~trt.type) +
  #scale_color_manual(values = aes_2col) +
  theme_bw()

p2


p1 + p2 +
  labs(caption = "lower NTs x change in mass by sex") +
  plot_layout(guides = "collect",
              axes = "collect",
              widths = c(2:1)) &
  theme(legend.position = "top") &
  labs(#lty = "population",
       y = "mass pupa - mass eclosion (g)") &
  #guides(color = "none") &
  scale_linetype_manual(values = c("dashed", "solid")) &
  scale_color_manual(values = c("#D95F02", "#7570B3")) &
  theme(strip.background.y = element_blank(), strip.text.y = element_blank())
```

## - both sexes

```{r}
# sexes combined
p1 <- ss_moredev %>% 
  filter(sex == "both" & 
           trt.type == "expt") %>%
  ggplot(aes(y = avg.dmass, x = minT,
             shape = sex, color = sex,
             group = interaction(pop, sex)
             )) +
  geom_errorbar(aes(ymin = avg.dmass - se.dmass, ymax = avg.dmass + se.dmass), width = 0.25) +
  geom_line(aes(lty = pop), alpha = 1) +
  geom_point(size = 2) +
  geom_text(aes(label = n), hjust = -0.25, vjust = -0.5, show.legend = FALSE) +
  labs(x = "minimum temperature (°C)") +
  facet_grid(sex~year) +
  #scale_color_manual(values = aes_2col) +
  theme_bw()

p1

p2 <- ss_moredev %>% 
  filter(sex == "both" & 
           trt.type == "ctrl") %>%
  ggplot(aes(y = avg.dmass, x = year,
             shape = sex, color = sex,
             group = interaction(pop, sex)
             )) +
  geom_errorbar(aes(ymin = avg.dmass - se.dmass, ymax = avg.dmass + se.dmass), width = 0.25) +
  geom_line(aes(lty = pop)) +
  geom_point(size = 2) +
  geom_text(aes(label = n), hjust = -0.25, vjust = -0.5, show.legend = FALSE) +
  labs(x = "year") +
  facet_grid(~trt.type) +
  #scale_color_manual(values = aes_2col) +
  theme_bw()

p2


p1 + p2 +
  labs(caption = "lower NTs x change in mass") +
  plot_layout(guides = "collect",
              axes = "collect",
              widths = c(2:1)) &
  theme(legend.position = "top") &
  labs(#lty = "population",
       y = "mass pupa - mass eclosion (g)") &
  #guides(color = "none") &
  scale_linetype_manual(values = c("dashed", "solid")) &
  scale_color_manual(values = c("#D95F02", "#7570B3")) &
  theme(strip.background.y = element_blank(), strip.text.y = element_blank())
```

# ---- moredev ----

# pup growth rate (g/days)

## - both sexes

```{r}
# sexes combined
p1 <- ss_moredev %>% 
  filter(sex == "both" & 
           trt.type == "expt") %>%
  ggplot(aes(y = avg.ratepup, x = minT,
             shape = sex, color = sex,
             group = interaction(pop, sex)
             )) +
  geom_errorbar(aes(ymin = avg.ratepup - se.ratepup, ymax = avg.ratepup + se.ratepup), width = 0.25) +
  geom_line(aes(lty = pop), alpha = 1) +
  geom_point(size = 2) +
  geom_text(aes(label = n), hjust = -0.25, vjust = -0.5, show.legend = FALSE) +
  labs(x = "minimum temperature (°C)") +
  facet_grid(sex~year) +
  #scale_color_manual(values = aes_2col) +
  theme_bw()

p1

p2 <- ss_moredev %>% 
  filter(sex == "both" & 
           trt.type == "ctrl") %>%
  ggplot(aes(y = avg.ratepup, x = year,
             shape = sex, color = sex,
             group = interaction(pop, sex)
             )) +
  geom_errorbar(aes(ymin = avg.ratepup - se.ratepup, ymax = avg.ratepup + se.ratepup), width = 0.25) +
  geom_line(aes(lty = pop)) +
  geom_point(size = 2) +
  geom_text(aes(label = n), hjust = -0.25, vjust = -0.5, show.legend = FALSE) +
  labs(x = "year") +
  facet_grid(~trt.type) +
  #scale_color_manual(values = aes_2col) +
  theme_bw()

p2


p1 + p2 +
  labs(caption = "lower NTs x pup growth rate") +
  plot_layout(guides = "collect",
              axes = "collect",
              widths = c(2:1)) &
  theme(legend.position = "top") &
  labs(#lty = "population",
       y = "pup growth rate (g/days)") &
  #guides(color = "none") &
  scale_linetype_manual(values = c("dashed", "solid")) &
  scale_color_manual(values = c("#D95F02", "#7570B3")) &
  theme(strip.background.y = element_blank(), strip.text.y = element_blank())
```

```{r}
# color by pop
p1 <- ss_moredev %>% 
  filter(sex == "both" & 
           trt.type == "expt") %>%
  ggplot(aes(y = avg.ratepupl, x = minT,
             shape = sex, color = pop,
             group = interaction(pop, sex)
             )) +
  geom_errorbar(aes(ymin = avg.ratepupl - se.ratepupl, ymax = avg.ratepupl + se.ratepupl), width = 0.25) +
  geom_line(aes(lty = pop), alpha = 1) +
  geom_point(size = 2) +
  geom_text(aes(label = n), hjust = -0.25, vjust = -0.5, show.legend = FALSE) +
  labs(x = "minimum temperature (°C)") +
  facet_grid(sex~year) +
  #scale_color_manual(values = aes_2col) +
  theme_bw()

p1

p2 <- ss_moredev %>% 
  filter(sex == "both" & 
           trt.type == "ctrl") %>%
  ggplot(aes(y = avg.ratepupl, x = year,
             shape = sex, color = pop,
             group = interaction(pop, sex)
             )) +
  geom_errorbar(aes(ymin = avg.ratepupl - se.ratepupl, ymax = avg.ratepupl + se.ratepupl), width = 0.25) +
  geom_line(aes(lty = pop)) +
  geom_point(size = 2) +
  geom_text(aes(label = n), hjust = -0.25, vjust = -0.5, show.legend = FALSE) +
  labs(x = "year") +
  facet_grid(~trt.type) +
  #scale_color_manual(values = aes_2col) +
  theme_bw()

p2


p1 + p2 +
  plot_layout(guides = "collect",
              axes = "collect",
              widths = c(2:1)) &
  theme(legend.position = "top") &
  labs(lty = "population", col = "population",
       #y = "growth rate [ln(g)/days]"
       y = "growth rate [ln(mg)/days]"
       ) &
  guides(shape = "none") &
  scale_linetype_manual(values = c("dashed", "solid")) &
  scale_color_manual(values = c("#41b6c4", "#225ea8")) &
  theme(strip.background.y = element_blank(), strip.text.y = element_blank()) &
  ylim(c(0.21, 0.49))
```



## - both sexes (log)

```{r}
# sexes combined
p1 <- ss_moredev %>% 
  filter(sex == "both" & 
           trt.type == "expt") %>%
  ggplot(aes(y = avg.ratepupl, x = minT,
             shape = sex, color = sex,
             group = interaction(pop, sex)
             )) +
  geom_errorbar(aes(ymin = avg.ratepupl - se.ratepupl, ymax = avg.ratepupl + se.ratepupl), width = 0.25) +
  geom_line(aes(lty = pop), alpha = 1) +
  geom_point(size = 2) +
  geom_text(aes(label = n), hjust = -0.25, vjust = -0.5, show.legend = FALSE) +
  labs(x = "minimum temperature (°C)") +
  facet_grid(sex~year) +
  #scale_color_manual(values = aes_2col) +
  theme_bw()

p1

p2 <- ss_moredev %>% 
  filter(sex == "both" & 
           trt.type == "ctrl") %>%
  ggplot(aes(y = avg.ratepupl, x = year,
             shape = sex, color = sex,
             group = interaction(pop, sex)
             )) +
  geom_errorbar(aes(ymin = avg.ratepupl - se.ratepupl, ymax = avg.ratepupl + se.ratepupl), width = 0.25) +
  geom_line(aes(lty = pop)) +
  geom_point(size = 2) +
  geom_text(aes(label = n), hjust = -0.25, vjust = -0.5, show.legend = FALSE) +
  labs(x = "year") +
  facet_grid(~trt.type) +
  #scale_color_manual(values = aes_2col) +
  theme_bw()

p2


p1 + p2 +
  labs(caption = "lower NTs x pup growth rate (log)") +
  plot_layout(guides = "collect",
              axes = "collect",
              widths = c(2:1)) &
  theme(legend.position = "top") &
  labs(#lty = "population",
       y = "pup growth rate (log mg/days)") &
  #guides(color = "none") &
  scale_linetype_manual(values = c("dashed", "solid")) &
  scale_color_manual(values = c("#D95F02", "#7570B3")) &
  theme(strip.background.y = element_blank(), strip.text.y = element_blank())
```


# pup growth (g vs days)

trying to make figs like kingsolver ea 2015 j exp biol (fig 2) idk if itll work tho lol

```{r}
ss_moredev %>%
  filter(trt.type == "expt" & sex == "both") %>%
  ggplot(aes(y = avg.masspupl, x = avg.tt,
             col = year
             )) +
  geom_point(aes(#col = year, 
                 shape = pop), size = 3) +
  geom_line(aes(group = year,
                lty = year)) +
  facet_wrap(~minT) +
  scale_shape_manual(values = c(1, 19))
# weird and very non-intuitive ngl LOL


p1 <- ss_moredev %>%
  filter(trt.type == "expt" & sex == "both") %>%
  ggplot(aes(y = avg.masspupl, x = avg.tt,
             col = minT
             )) +
  geom_point(aes(#col = year, 
                 shape = pop), size = 2.5) +
  geom_line(aes(group = minT,
                lty = minT)) +
  facet_wrap(year ~ .) +
  scale_shape_manual(values = c(1, 19)) +
  #scale_color_manual(values = bin_aes$temp3$col) +
  scale_color_hue(direction = -1) +
  labs(y = "ln mass (g)", x = "age (days)",
       shape = "population",
       col = "minimum\ntemperature (°C)", lty = "minimum\ntemperature (°C)") +
  theme_bw()

p1

p2 <- ss_moredev %>%
  filter(trt.type == "ctrl" & sex == "both") %>%
  ggplot(aes(y = avg.masspupl, x = avg.tt,
             #col = minT
             )) +
  # geom_point(aes(#col = year, 
  #                shape = pop), size = 2.5) +
  # geom_line(aes(group = year,
  #               lty = year)) +
  geom_point(aes(shape = year), size = 2.5) +
  geom_line(aes(lty = pop)) +
  facet_wrap(trt.type ~ .) +
  scale_shape_manual(values = c(2, 17)) +
  #scale_color_manual(values = bin_aes$temp3$col) +
  scale_color_hue(direction = -1) +
  labs(y = "ln mass (g)", x = "age (days)",
       #shape = "population", lty = "year"
       shape = "year", lty = "population") +
  theme_bw()

p2

p1 + p2 + 
  plot_layout(#guides = "collect",
              axes = "collect",
              widths = c(2:1)) &
  theme(legend.position = "top",
        legend.direction = "vertical") &
  ylim(c(7.65, 8.8)) &
  xlim(c(19, 35))

```
## - expt only, yrs combined
```{r}
# the above but by instar...
ss_ntw.ins <- all_long %>% calc.instats2()
```


```{r}
# first attempts...

# by minT
ss_ntw.ins %>%
  filter(year == "both") %>%
  filter(trt.type != "ctrl") %>%
  ggplot(aes(y = avg.logmass, x = avg.tt,
             #col = minT, 
             #col = year,
             lty = pop, shape = pop)) +
  geom_point(size = 2) +
  geom_line(aes(group = interaction(minT, year, pop))) +
  #facet_wrap(year ~ minT) +
  facet_wrap(~ minT) +
  scale_color_hue(direction = -1) +
  theme_bw()

# by pop
labs <- c("40 - 33°C\n(36.5 ± 3.5°C)\n", "40 - 26°C\n(33 ± 7°C)\n",  "40 - 19°C\n(29.5 ± 10.5°C)\n")
ss_ntw.ins %>%
  filter(year == "both") %>%
  filter(trt.type != "ctrl") %>%
  mutate(pop = factor(pop, levels = c("lab", "field")),
         minT = factor(minT, levels = c(33, 26, 19))) %>%
  ggplot(aes(y = avg.logmass, x = avg.tt,
             col = minT, 
             #col = year,
             lty = minT, shape = minT)) +
  geom_point(size = 2.5) +
  geom_line(aes(group = interaction(minT, year, pop)), lwd = 0.75) +
  #geom_errorbar(aes(ymax = avg.logmass + se.logmass, ymin = avg.logmass - se.logmass)) + # too small to see lol
  #facet_wrap(year ~ minT) +
  facet_wrap(~ pop) +
  #scale_color_hue(direction = -1) +
  xlim(c(0, 28)) +
  labs(y = "ln(mass)", x = "age (days)",
       #col = "night temperature", shape = "night temperature", lty = "night temperature"
       ) +
  scale_color_manual(values = c("darkgoldenrod2", "deeppink3", "darkorchid4"), 
                     #labels = c("19°C", "26°C", "33°C"),
                     labels = labs,
                     name = "") + 
  scale_shape_discrete(#labels = c("19°C", "26°C", "33°C"),
                       labels = labs,
                       name = "") +
  scale_linetype_discrete(#labels = c("19°C", "26°C", "33°C"),
                          labels = labs,
                          name = "") +
  ylim(c(3.4, 8.8)) + # to match w 2x2 fig axes for alignment in ppt
  theme_bw()
```


## - incl ctrl (sep)

```{r}
p1 <- ss_ntw.ins %>%
  filter(year == "both" &
           trt.type == "ctrl") %>%
  ggplot(aes(y = avg.logmass, x = avg.tt,
             col = pop, lty = pop)) +
  geom_point(size = 1.75) +
  geom_line(lwd = 0.75) +
  #geom_errorbar(aes(ymax = avg.logmass + se.logmass, ymin = avg.logmass - se.logmass), width = 0.5) +
  facet_grid(year ~ trt.type, labeller = labeller(trt.type = as_labeller(c(`ctrl` = "control (26/26°C)")))) +
  scale_linetype_manual(values = c("dashed", "solid"), name = "") +
  scale_color_manual(values = c("#41b6c4", "#225ea8"), name = "") + 
  theme_bw() +
  theme(strip.background.y = element_blank(),
        strip.text.y = element_blank())

p1

labs <- c("40 - 33°C\n(36.5 ± 3.5°C)\n", "40 - 26°C\n(33 ± 7°C)\n",  "40 - 19°C\n(29.5 ± 10.5°C)\n")

p2 <- ss_ntw.ins %>%
  filter(year == "both" &
           trt.type == "expt") %>%
  mutate(pop = factor(pop, levels = c("lab", "field")),
         minT = factor(minT, levels = c(33, 26, 19))) %>%
  ggplot(aes(y = avg.logmass, x = avg.tt,
             col = minT, lty = minT, shape = minT)) +
  geom_point(size = 1.75) +
  geom_line(aes(group = interaction(minT, year, pop)), lwd = 0.75) +
  #geom_errorbar(aes(ymax = avg.logmass + se.logmass, ymin = avg.logmass - se.logmass)) + # too small to see lol
  facet_grid(year ~ pop) +
  #scale_color_hue(direction = -1) +
  labs(#y = "ln(mass)", x = "age (days)",
       #col = "night temperature", shape = "night temperature", lty = "night temperature"
       ) +
  scale_color_manual(values = c("darkgoldenrod2", "deeppink3", "darkorchid4"), 
                     labels = labs, name = "") + 
  scale_shape_discrete(labels = labs, name = "") +
  scale_linetype_discrete(labels = labs, name = "") +
  theme_bw() +
  theme(axis.title.y = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks.y = element_blank())

p2


p1 + p2 +
  plot_layout(guides = "collect",
              axes = "collect",
              widths = c(1:2)) &
  theme(legend.position = "top",
        strip.background.y = element_blank(),
        strip.text.y = element_blank()
        ) &
  geom_point(size = 2) &
  ylim(c(3.2, 9)) &
  xlim(c(2.8, 34)) &
  labs(y = "ln[mass (mg)]", x = "days (age)") &
  guides(color = "none", lty = "none", shape = "none")
```
## - incl ctrl (together)
```{r}
labs <- c("26 - 26°C\n(26 ± 0°C)\n", "40 - 33°C\n(36.5 ± 3.5°C)\n", 
          "40 - 26°C\n(33 ± 7°C)\n",  "40 - 19°C\n(29.5 ± 10.5°C)\n")

ss_ntw.ins %>%
  filter(year == "both") %>%
  mutate(trt = case_when(trt.type == "expt" ~ case_when(minT == 19 ~ 419,
                                                        minT == 26 ~ 426,
                                                        minT == 33 ~ 433),
                         TRUE ~ 260)) %>%
  mutate(pop = factor(pop, levels = c("lab", "field")),
         trt = factor(trt, levels = c(260, 433, 426, 419))) %>%
  #filter(trt.type == "ctrl") %>%
  ggplot(aes(y = avg.logmass, x = avg.tt,
             col = trt, lty = trt, shape = trt)) +
  geom_point(size = 2) +
  geom_line(lwd = 0.8) +
  facet_grid(~pop) +
  labs(y = "ln[mass (mg)]", x = "days (age)",
       ) +
  scale_color_manual(values = c("deepskyblue3", 
                                "darkgoldenrod2", "deeppink3", "darkorchid4"
                                ),
                     labels = labs, name = ""
                     ) +
  scale_shape_discrete(labels = labs, name = "") +
  scale_linetype_discrete(labels = labs, name = "") +
  #guides(color = "none", shape = "none", lty = "none") +
  theme_bw()
```



#  ---- ntw vs 2x2 ----

sorta recreating kingsolver 2015 figs

## - df setup
```{r}
# subset ntw vs 2x2
vs_long <- all_long %>%
  filter(pop == "lab" & diet == "LD") %>%
  select(-for.const) %>%
  mutate(for.temps = case_when(year == 2023 & cohort %in% c("A", "B") ~ "Y",
                               TRUE ~ "N")) %>%
  filter(for.temps == "Y" | for.ntw == "Y") %>% 
  mutate(for.vs = case_when(for.temps == "Y" & for.ntw == "Y" ~ 2,
                            for.temps == "N" & for.ntw == "Y" ~ 1,
                            for.temps == "Y" & for.ntw == "N" ~ 0))

vs_long.ntw <- filter(vs_long, for.ntw == "Y")
vs_long.temps <- filter(vs_long, for.temps == "Y")
```

```{r}
# ss calcs
ss_vs.ntw <- vs_long.ntw %>%
  calc.instats() %>%
  mutate(for.vs = "ntw")

ss_vs.temps <- vs_long.temps %>%
  calc.instats() %>%
  mutate(for.vs = "temps")

ss_vs <- Reduce(full_join, (list(ss_vs.ntw, ss_vs.temps))) %>%
  filter(pop == "lab") %>% # can remove later if want to incl field
  mutate(for.vs = factor(for.vs, levels = c("temps", "ntw")),
         meanT = factor(meanT, levels = c(26, 29.5, 33, 36.5)),
         flucT = factor(flucT, levels = c(0, 3.5, 7, 10.5)))

```

# ntw vs 2x2

## - rates vs mean T (fig 5)
```{r}
ss_vs %>%
  filter(instar == "pupa" & year == "both") %>%
  ggplot(aes(x = meanT, y = avg.ldevrate,
             lty = flucT, color = flucT, shape = flucT)) +
  geom_point(size = 2) +
  geom_line(aes(group = flucT)) +
  facet_wrap(for.vs ~ ., scales = "free_x") +
  scale_color_hue(direction = -1)

ss_vs %>%
  filter(instar == "pupa" & year == "both") %>%
  ggplot(aes(x = meanT, y = avg.ldevrate,
             lty = flucT, color = flucT, shape = for.vs)) +
  geom_point(size = 3) +
  geom_line(aes(group = interaction(flucT, for.vs))) +
  scale_color_hue(direction = -1)
```
## - rates vs flucT
```{r}
ss_vs %>%
  filter(instar == "pupa" & year == "both") %>%
  ggplot(aes(x = flucT, y = avg.ldevrate,
             lty = meanT, color = meanT, shape = for.vs)) +
  geom_point(size = 3) +
  geom_line(aes(group = interaction(meanT, for.vs))) +
  scale_color_hue(direction = -1)
```
## - mean vs flucts

```{r}
ss_vs %>%
  filter(instar == "pupa" & year == "both") %>%
  ggplot(aes(y = meanT, x = flucT, 
             shape = for.vs, lty = for.vs)) +
  geom_point(aes(color = avg.ldevrate, #size = avg.ldevrate
                 ), 
             size = 3, 
             position = position_dodge(0.1)
             ) +
  geom_line(aes(group = for.vs), 
            #position = position_dodge(0.1)
            ) 

# this is so goofy lol
```

## - mass vs days (fig 2)

```{r}
# color by meanT
ss_vs %>%
  mutate(trt = factor(trt)) %>%
  filter(#instar == "pupa" & 
           year == "both") %>%
  ggplot(aes(y = avg.logmass, x = avg.tt,
             col = meanT, lty = meanT, shape = flucT)) +
  geom_point(size = 2) +
  geom_line() +
  facet_wrap(for.vs ~ .) +
  guides(lty = "none") +
  scale_color_hue(direction = -1)

# color by flucT
ss_vs %>%
  mutate(trt = factor(trt)) %>%
  filter(#instar == "pupa" & 
           year == "both") %>%
  ggplot(aes(y = avg.logmass, x = avg.tt,
             col = flucT, lty = flucT, shape = meanT)) +
  geom_point(size = 2) +
  geom_line() +
  facet_wrap(for.vs ~ .) +
  guides(lty = "none") +
  scale_color_hue(direction = -1)


# combined col by meanT
ss_vs %>%
  mutate(trt = factor(trt)) %>%
  filter(#instar == "pupa" & 
           year == "both") %>%
  ggplot(aes(y = avg.logmass, x = avg.tt,
             col = meanT, lty = flucT, shape = for.vs)) +
  geom_point(size = 2) +
  geom_line() +
  #guides(lty = "none") +
  scale_color_hue(direction = -1)

# combined col by flucT
ss_vs %>%
  mutate(trt = factor(trt)) %>%
  filter(#instar == "pupa" & 
           year == "both") %>%
  ggplot(aes(y = avg.logmass, x = avg.tt,
             col = flucT, lty = meanT, shape = for.vs)) +
  geom_point(size = 2) +
  geom_line() +
  #guides(lty = "none") +
  scale_color_hue(direction = -1)
```

# 2x2 only

```{r}
ss_vs.temps %>%
  #filter(flucT == 0) %>%
  ggplot(aes(y = avg.logmass, x = avg.tt,
             col = as.factor(meanT), 
             lty = as.factor(flucT), shape = as.factor(flucT))
         ) +
  geom_point(size = 2.5) +
  geom_line() +
  #geom_errorbar(aes(ymax = avg.logmass + se.logmass, ymin = avg.logmass - se.logmass), width = 1) +
  facet_grid(~ meanT, labeller = as_labeller(c(`26` = "mean = 26°C",
                                               `33` = "mean = 33°C"))) +
  labs(y = "ln mass (mg)", x = "age (days)") +
  guides(color = "none") +
  scale_linetype_discrete(labels = c("±0°C", "±7°C"), name = "") +
  scale_shape_discrete(labels = c("±0°C", "±7°C"), name = "") +
  scale_color_manual(values = c("deepskyblue3", "darkorange2")) + 
  #scale_color_hue(direction = -1) +
  ylim(c(3.4, 8.8)) +
  theme_bw() #&
  # theme(legend.position = "top")


ss_vs.temps %>%
  filter(flucT == 7) %>%
  ggplot(aes(y = avg.logmass, x = avg.tt,
             col = as.factor(meanT), 
             lty = as.factor(flucT), shape = as.factor(flucT))
         ) +
  geom_point(size = 2.5) +
  geom_line(#lty = "dashed"
            ) +
  #geom_errorbar(aes(ymax = avg.logmass + se.logmass, ymin = avg.logmass - se.logmass), width = 1) +
  labs(y = "ln mass (mg)", x = "age (days)") +
  scale_linetype_discrete(labels = c("±0°C", "±7°C"), name = "") +
  scale_shape_discrete(labels = c("±0°C", "±7°C"), name = "") +
  scale_color_manual(values = c("deepskyblue3", "darkorange2"), name = "") + 
  #scale_color_hue(direction = -1) +
  ylim(c(3.4, 8.8)) +
  theme_bw()
```


