---
title: "03-stats/ntw-compare"
date: "2025-02-19"
---

# preamble

dates in this doc are for when i first did this stuff bc a lot of the modeling is based off inputs from joel mtgs on/before corresponding dates LOL

## loading

```{r}
here::i_am("2024/03-stats/ntw-compare.Rmd")
library(here)

library(tidyverse)
library(lme4) # for lmer..

source(here::here("set-paths.R"))
source(here::here(bin_paths24$wrangle, "ntw-compare_p.R"))
rm(filter.2pops, se)
```

## df prep

```{r}
# focusing on exptal bugs only that weren't lab on TB
ntw_expt <- ntw_wide %>%
  filter(!(diet == "TB" & pop == "lab") & trt.type == "expt") %>%
  mutate(dmass = mass.pupa - mass.eclose,
         rate.pup = mass.pupa/tt.pupa)
```

```{r}
# other subsets

# omit accidental deaths (so either pmd, pup, LPI)
ntw_expt.surv <- ntw_expt %>%
  filter(is.pup != 2)

# omit unsexed pupa
ntw_expt.sex <- ntw_expt %>%
  filter(!is.na(sex))
```


# pupal survival

- what to do w/ modeling from 250213 joel mtg: 
  - look into nested model comparisons (try MuMin first, then AICcmodaug). compare the interaction (temp, pop, year), then additive, then simplest

- qns:
  - check surv to pup
  - of the surv, who's sup?
  - pup to eclosion?

## 250213

scrappy attempts pre 250213 joel mtg, ignore these for the most part

```{r}
mod.surv_minT <- glm(is.pup ~ minT*pop, data = ntw_expt.surv, family = "binomial") # need to add `year`

mod.surv_meanT <- glm(is.pup ~ meanT*pop, data = ntw_expt.surv, family = "binomial")
  # ignore meanT bc it's confounded w minT

anova(mod.surv_minT, mod.surv_meanT, test = "Chisq") 
```

```{r}
# actual modeling attempts w/ MuMin and things




```

# pupal mass

## 250213

what affects pupal mass? Tmin, sex, year, pop?

(numbering is just based on when i ran them lol)

```{r}
# 01: test the full complex int mod vs the full additive model
# mods.pmass <- list(int_01 = lm(mass.pupa ~ year*minT*pop*sex, data = ntw_expt.sex),
#                    add_01 = lm(mass.pupa ~ year + minT + pop + sex, data = ntw_expt.sex))
# names(mods.pmass)

mod.pmass_int01 <- lm(mass.pupa ~ year*minT*pop*sex, data = ntw_expt.sex)
mod.pmass_add01 <- lm(mass.pupa ~ year + minT + pop + sex, data = ntw_expt.sex)

anova(mod.pmass_int01, mod.pmass_add01, test = "Chisq") # no sig diff btwn add/int: add is better

# just look at the variables
anova(mod.pmass_int01)
anova(mod.pmass_add01)
```

```{r}
# 02: look at int mod again
# based on plotting the pupal masses by temp/sex/yr/pop. which ints matter?

# drop year
mod.pmass_int02 <- lm(mass.pupa ~ minT*pop*sex, data = ntw_expt.sex) 

anova(mod.pmass_int01, mod.pmass_int02, test = "Chisq") # temp*pop*sex is better

anova(mod.pmass_int02)

# drop sex
mod.pmass_int03 <- lm(mass.pupa ~ minT*pop, data = ntw_expt.sex)

anova(mod.pmass_int02, mod.pmass_int03, test = "Chisq") # no sig diff, so keep sex?

# which terms matter?
anova(mod.pmass_int02)
```

- `mass.pupa ~ minT*pop*sex` seems good, with the following sig ints:

  - minT; pop = `***`
  
  - sex, minT:pop = `*`

```{r}
# 03: look into the additive mods some more
# drop year
mod.pmass_add02 <- lm(mass.pupa ~ minT + pop + sex, data = ntw_expt.sex)

anova(mod.pmass_int02, mod.pmass_add02, test = "Chisq") # no sig diff
```

idt this one is right lol bc year def makes a difference

## 250220

per 250220 joel mtg: try the 2 way interactions only....

```{r}
# mods.pmass <- list(mods.pmass,
#                    n2way_01 =lm(mass.pupa ~ (year + minT + pop + sex)^2, data = ntw_expt.sex))
  # ONE DAY... we'll figure it out shoving models into lists lol

mod.pmass_n2way01 <- lm(mass.pupa ~ (year + minT + pop + sex)^2, data = ntw_expt.sex)

anova(mod.pmass_n2way01)
# *** yr, minT, pop
# * sex, minT:pop
```

# time to pup

## 250213

```{r}
# 01 full models
mod.pdev_int01 <- lm(tt.pupa ~ year*minT*pop*sex, data = ntw_expt)
mod.pdev_add01 <- lm(tt.pupa ~ year+minT+pop+sex, data = ntw_expt)

anova(mod.pdev_int01, mod.pdev_add01, test = "Chisq")

anova(mod.pdev_int01)
anova(mod.pdev_add01)
```

intmod is better?

## 250220

per 250220 joel mtg, try 2 way interactions

```{r}
mod.pdev_n2way01 <- lm(tt.pupa ~ (year + minT + pop + sex)^2, data = ntw_expt)

anova(mod.pdev_n2way01)
# *** = yr, minT, pop, yr:minT
# * = yr:pop

# sex isn't rly relevant here yet so omit
mod.pdev_n2way02 <- lm(tt.pupa ~ (year + minT + pop)^2, data = ntw_expt)
anova(mod.pdev_n2way02)
# *** = yr, minT, pop
# ** = year:minT
# * = yr:pop


# yr matters, is it bc of the field bug timing?
mod.pdev_n2way03a <- lm(tt.pupa ~ (year*minT), data = filter(ntw_expt, pop == "lab"))
mod.pdev_n2way03b <- lm(tt.pupa ~ (year*minT), data = filter(ntw_expt, pop == "field"))
anova(mod.pdev_n2way03a)
anova(mod.pdev_n2way03b)
# actually, it's the lab bugs lol. prob bc we keep selecting for faster bugs in colony

```

# for later

## fecundity (23v24)

## fertility (2023 only)
