---
title: "ntw 2023 v 2024 data comparisons"
date: "2024-10-08"
---

# 0. roadmap & loading

goal: compare 2023 and 2024 ntw development data. needs some wrangling lol (esp 2023)

wip: combine fertility data...


```{r}
source("./helpers_ntw-compare.R")
source("./helpers_aesthetics.R")

test <- d23
#d23 <- test
```


# 4. figs & stats prep

## - figs troubleshooting

larval "#1B9E77" 
pup "#D95F02" 
adult "#7570B3"

```{r}
# fig troubleshooting
# filter(all_wide, year == 2023 & sex == "f" & !is.na(tt.surv)) %>% View()
# filter(ntw_wide, year == 2023 & sex == "f" & !is.na(tt.surv)) %>% View()
# filter(ntw_wide, year == 2023 & sex == "f" & pop == "field" & minT == 33) %>% View()
# filter(ss_ntw, year == 2023 & sex == "f" & stage == "ad") %>% View()
```


# ### analyses ###

linebreak for my eyes üëç

# pupal survival

## - figs

// todo
2025-01-23: 
- make these functions also LOL

```{r}
# NTs on pupal survival 

p1 <- ss_ntw %>% 
  filter(stage == "la" & trt.type == "expt") %>% 
  ggplot(aes(y = prop.survpup, x = minT,
             color = stage, 
             lty = pop, shape = year,
             group = interaction(pop, trt.type))) +
  geom_line() +
  geom_point(size = 2) +
  geom_text(aes(label = n.dev), hjust = -0.25, vjust = -0.5) +
  labs(x = "minimum temperature (¬∞C)") +
  facet_wrap(~year) +
  theme_bw()

p1


p2 <- ss_ntw %>% 
  filter(stage == "la" & trt.type == "ctrl") %>% 
  mutate(trt.type = "control (26/26 ¬∞C)") %>%
  ggplot(aes(y = prop.survpup, x = year,
             color = stage, 
             lty = pop, shape = year,
             group = interaction(pop, trt.type))) +
  geom_line() +
  geom_point(size = 2) +
  geom_text(aes(label = n.dev), hjust = -0.25, vjust = -0.5) +
  facet_wrap(~trt.type) +
  theme_bw()

p2

# merge
p1 + p2 +
  labs(caption = "do lower NTs increase survival to pup?") +
  plot_layout(guides = "collect",
              axes = "collect",
              widths = c(2:1)) &
  theme(legend.position = "top") &
  labs(lty = "population",
       y = "proportion survived to pupation") &
  guides(color = "none") &
  scale_linetype_manual(values = c("dashed", "solid")) &
  scale_shape_manual(values = c(1, 16)) &
  scale_color_manual(values = "#1B9E77") &
  ylim(c(0, 1))

```
## - stats

```{r}
ntw_expt.surv <- ntw_expt %>%
  filter(surv.outcome != 2)
```

```{r}
mod.surv_minT <- glm(surv.outcome ~ minT*pop, data = ntw_expt.surv, family = "binomial")
# mod.surv_meanT <- glm(surv.outcome ~ meanT*pop, data = ntw_expt.surv, family = "binomial")
  # ignore meanT bc it's confounded w minT

anova(mod.surv_minT, mod.surv_meanT, test = "Chisq") 

```


# dev outcomes (sup)

## - figs: pmds + pups

```{r}
# not stacking stages/grouping by pop as desired
ss_devall2 %>%
  ggplot(aes(y = p, x = trt, fill = stage)) +
  #geom_col(position = "dodge") + facet_wrap(~year) +
  #geom_col() + facet_wrap(year~pop) +
  geom_col(position = "dodge", stat = "identity") + facet_wrap(~year) +
  labs(caption = "pmds + dev fates of pups") +
  theme_bw()

# okay apparently u just cant stack AND dodge at the same time lol says google
  # https://stackoverflow.com/questions/12715635/ggplot2-bar-plot-with-both-stack-and-dodge
  # https://stackoverflow.com/questions/46597278/how-to-plot-a-stacked-and-grouped-bar-chart-in-ggplot
ss_devall2 %>%
  ggplot(aes(y = p, x = interaction(pop, trt), fill = stage)) +
  geom_bar(position = "stack", stat = "identity") + facet_grid(~year) +
  #geom_col() + facet_wrap(year~pop) +
  labs(caption = "pmds + dev fates of pups") +
  theme_bw()

# this is the one!!!!!
ss_devall2 %>%
  ggplot(aes(y = p, x = interaction(pop, trt), fill = stage)) +
  geom_bar(position = "stack", 
           #position = position_fill(reverse = TRUE),
           stat = "identity") + 
  facet_grid(~interaction(pop,year), scale = "free", 
             #labeller = as_labeller(interaction(pop,year) = c("field 2023", "lab 2023", "field 2024", "lab 2024"))
             ) +
  #geom_col() + facet_wrap(year~pop) +
  labs(caption = "pmds + instars of pups",
       fill = "stage",
       x = "D-N treatment (¬∞C)",
       y = "proportion") +
  scale_x_discrete(labels = c("26-26", "40-19", "40-26", "40-33"), guide = guide_axis(angle = 45)) +
  #theme(axis.text.x.bottom = element_text(angle = 90)) +
  scale_fill_brewer(palette = "Blues", direction = -1) +
  theme_bw()
  

# trying w/ alpha.. tldr i think i need to combine some of these variables tgt lol. but also redo the math
# (its not adding to 1 bc need x=interaction)
ss_devall2 %>%
  ggplot(aes(y = p, x = pop, fill = stage, group = trt, alpha = trt)) +
  geom_bar(position = "dodge", stat = "identity") + facet_grid(~year) +
  #geom_col() + facet_wrap(year~pop) +
  labs(caption = "pmds + dev fates of pups") +
  theme_bw()
```

## - figs: pups only

```{r}
# looking only at survivors
ss_devpmd2 %>%
  ggplot(aes(y = p, x = interaction(pop, trt), fill = stage)) +
  geom_bar(position = "stack", 
           #position = position_fill(reverse = TRUE),
           stat = "identity") + 
  facet_grid(~interaction(pop,year), scale = "free", 
             #labeller = as_labeller(interaction(pop,year) = c("field 2023", "lab 2023", "field 2024", "lab 2024"))
             ) +
  #geom_col() + facet_wrap(year~pop) +
  labs(caption = "instars of things that survived to pupation",
       fill = "stage",
       x = "D-N treatment (¬∞C)",
       y = "proportion") +
  scale_x_discrete(labels = c("26-26", "40-19", "40-26", "40-33"), guide = guide_axis(angle = 45)) +
  #theme(axis.text.x.bottom = element_text(angle = 90)) +
  scale_fill_brewer(palette = "Blues", 
                    #direction = -1
                    ) +
  theme_bw()
```




# dev time & longevity

// todo
- 2025-01-30: look into forcing y-axes limits to be the same w `ggh4x`
  - https://teunbrand.github.io/ggh4x/articles/Facets.html
  
## - figs: by sex

```{r}
# NTs on development time/longevity
# see this
  # https://stackoverflow.com/questions/78193007/how-do-i-control-the-alpha-of-a-geom-point-fill

p1 <- ss_ntw %>% 
  mutate(sex = case_when(is.na(sex) ~ "both",
                         TRUE ~ as.character(sex))) %>%
  filter(!(stage == "ad" & sex == "all")) %>%
  filter((stage == "la" | stage == "ad") & trt.type == "expt") %>% #View()
  ggplot(aes(y = avg.tt, x = minT,
             color = stage, #fill = stage, 
             shape = sex,
             group = interaction(pop, stage, sex)
             )) +
  geom_errorbar(aes(ymin = avg.tt - se.tt, ymax = avg.tt + se.tt), width = 0.25) +
  geom_line(aes(lty = pop), alpha = 1) +
  geom_point(aes(#alpha = year, 
                 color = stage), size = 2) +
  geom_text(aes(label = n), hjust = -0.25, vjust = -0.5, show.legend = FALSE) +
  #geom_point(fill = NA, size = 2) +
  labs(x = "minimum temperature (¬∞C)") +
  facet_wrap(~year) + # orig
  # facet_grid(stage~year, scales = "free_y"
  #            ) +
  theme_bw()

p1


p2 <- ss_ntw %>% 
  mutate(sex = case_when(is.na(sex) ~ "both",
                         TRUE ~ as.character(sex))) %>%
  filter(!(stage == "ad" & sex == "all")) %>%
  filter((stage == "la" | stage == "ad") & trt.type == "ctrl") %>% 
  mutate(trt.type = "control (26/26 ¬∞C)") %>%
  ggplot(aes(y = avg.tt, x = year,
             color = stage, 
             #fill = stage, shape = sex,
             group = interaction(pop, stage, sex)
             )) +
  geom_errorbar(aes(ymin = avg.tt - se.tt, ymax = avg.tt + se.tt), width = 0.25) +
  geom_line(aes(lty = pop), alpha = 1) +
  #geom_point(aes(alpha = year), size = 2) +
  geom_text(aes(label = n), hjust = -0.25, vjust = -0.5, show.legend = FALSE) +
  geom_point(#fill = NA, 
             size = 2) +
  labs(x = "year") +
  facet_wrap(~trt.type) + # orig
  # facet_grid(stage~trt.type, scales = "free_y"
  #            ) +
  theme_bw()

p2

# merge
p1 + p2 +
  labs(caption = "do lower NTs reduce dev time?") +
  plot_layout(guides = "collect",
              axes = "collect",
              widths = c(2:1)) &
  theme(legend.position = "top") &
  labs(#lty = "population",
       y = "development time / longevity (days)") &
  #guides(color = "none") &
  scale_linetype_manual(values = c("dashed", "solid")) &
  scale_shape_manual(values = c(21, 24, 22)
                     #c(16, 17, 15)
                     #c(1, 2, 0)
                     ) &
  scale_color_manual(values = c("#1B9E77", "#7570B3")) &
  scale_fill_manual(values = c("#1B9E77", "#7570B3")) &
  theme(strip.background.y = element_blank(), strip.text.y = element_blank()) &
  expand_limits(y = 37)
  #scale_alpha_manual(values = c(0.1,1)) &
  #ylim(c(2.5, 35))

```

# mass

## - figs: by sex

```{r}
# NTs on pupal/adult mass

p1 <- ss_ntw %>% 
  mutate(sex = case_when(is.na(sex) ~ "both",
                         TRUE ~ as.character(sex))) %>%
  filter(!(stage == "ad" & sex == "all")) %>%
  filter((stage == "pu" | stage == "ad") & trt.type == "expt") %>% #View()
  ggplot(aes(y = avg.mass, x = minT,
             color = stage, #fill = stage, 
             shape = sex,
             group = interaction(pop, stage, sex)
             )) +
  geom_errorbar(aes(ymin = avg.mass - se.mass, ymax = avg.mass + se.mass), width = 0.25) +
  geom_line(aes(lty = pop), alpha = 1) +
  geom_point(aes(#alpha = year, 
                 color = stage), size = 2) +
  #geom_point(fill = NA, size = 2) +
  labs(x = "minimum temperature (¬∞C)") +
  facet_grid(#stage
             ~year) +
  theme_bw()

p1

p2 <- ss_ntw %>% 
  mutate(sex = case_when(is.na(sex) ~ "both",
                         TRUE ~ as.character(sex))) %>%
  filter(!(stage == "ad" & sex == "all")) %>%
  filter((stage == "pu" | stage == "ad") & trt.type == "ctrl") %>% 
  mutate(trt.type = "control (26/26 ¬∞C)") %>%
  ggplot(aes(y = avg.mass, x = year,
             color = stage, #fill = stage, 
             shape = sex,
             group = interaction(pop, stage, sex)
             )) +
  geom_errorbar(aes(ymin = avg.mass - se.mass, ymax = avg.mass + se.mass), width = 0.25) +
  geom_line(aes(lty = pop), alpha = 1) +
  geom_point(#aes(alpha = year), 
             size = 2) +
  #geom_point(fill = NA, size = 2) +
  labs(x = "year") +
  facet_grid(#stage
               ~trt.type) +
  theme_bw()

p2

# merge
p1 + p2 +
  labs(caption = "do lower NTs lead to larger mass?") +
  plot_layout(guides = "collect",
              axes = "collect",
              widths = c(2:1)) &
  theme(legend.position = "top") &
  labs(#lty = "population",
       y = "mass (g)") &
  #guides(color = "none") &
  scale_linetype_manual(values = c("dashed", "solid")) &
  scale_shape_manual(values = c(24, 22)) &
  scale_color_manual(values = c("#D95F02", "#7570B3")) &
  scale_fill_manual(values = c("#D95F02", "#7570B3")) &
  #scale_alpha_manual(values = c(0.1,1)) &
  theme(strip.background.y = element_blank(), strip.text.y = element_blank()) &
  ylim(c(0.75, 7.25))

```

## - figs: sexes combined

```{r}
# NTs on pupal/adult mass

p1 <- ss_ntw %>% 
  filter(sex == "all") %>%
  filter((stage == "pu" | stage == "ad") & trt.type == "expt") %>% #View()
  ggplot(aes(y = avg.mass, x = minT,
             color = stage, #fill = stage, 
             group = interaction(pop, stage)
             )) +
  geom_errorbar(aes(ymin = avg.mass - se.mass, ymax = avg.mass + se.mass), width = 0.25) +
  geom_line(aes(lty = pop), alpha = 1) +
  geom_point(aes(#alpha = year, 
                 color = stage), size = 2) +
  #geom_point(fill = NA, size = 2) +
  labs(x = "minimum temperature (¬∞C)") +
  facet_grid(#stage
             ~year) +
  theme_bw()

p1

p2 <- ss_ntw %>% 
  filter(sex == "all") %>%
  filter((stage == "pu" | stage == "ad") & trt.type == "ctrl") %>% 
  mutate(trt.type = "control (26/26 ¬∞C)") %>%
  ggplot(aes(y = avg.mass, x = year,
             color = stage, #fill = stage, 
             group = interaction(pop, stage)
             )) +
  geom_errorbar(aes(ymin = avg.mass - se.mass, ymax = avg.mass + se.mass), width = 0.25) +
  geom_line(aes(lty = pop), alpha = 1) +
  geom_point(#aes(alpha = year), 
             size = 2) +
  #geom_point(fill = NA, size = 2) +
  labs(x = "year") +
  facet_grid(#stage
               ~trt.type) +
  theme_bw()

p2

# merge
p1 + p2 +
  labs(caption = "do lower NTs lead to larger mass?") +
  plot_layout(guides = "collect",
              axes = "collect",
              widths = c(2:1)) &
  theme(legend.position = "top") &
  labs(#lty = "population",
       y = "mass (g)") &
  #guides(color = "none") &
  scale_linetype_manual(values = c("dashed", "solid")) &
  scale_color_manual(values = c("#D95F02", "#7570B3")) &
  scale_fill_manual(values = c("#D95F02", "#7570B3")) &
  #scale_alpha_manual(values = c(0.1,1)) &
  theme(strip.background.y = element_blank(), strip.text.y = element_blank()) &
  ylim(c(0.75, 7.25))

```
# pupal mass

## - figs

how does pup mass look across yrs, pops, trts, sexes, temps? (getting some intuition of what to do for modeling)

```{r}
# NTs on pupal mass

p1 <- ss_ntw %>% 
  filter(stage == "pu" & trt.type == "expt") %>% #View()
  ggplot(aes(y = avg.mass, x = minT,
             color = sex, shape = sex,
             group = interaction(pop, sex)
             )) +
  geom_errorbar(aes(ymin = avg.mass - se.mass, ymax = avg.mass + se.mass), width = 0.25) +
  geom_line(aes(lty = pop), alpha = 1) +
  geom_point(aes(color = sex), size = 2) +
  labs(x = "minimum temperature (¬∞C)") +
  facet_grid(is.sep~year) +
  theme_bw()

p1

p2 <- ss_ntw %>% 
  filter(stage == "pu" & trt.type == "ctrl") %>% 
  mutate(trt.type = "control (26/26 ¬∞C)") %>%
  ggplot(aes(y = avg.mass, x = year,
             color = sex, shape = sex,
             group = interaction(pop, sex)
             )) +
  geom_errorbar(aes(ymin = avg.mass - se.mass, ymax = avg.mass + se.mass), width = 0.25) +
  geom_line(aes(lty = pop), alpha = 1) +
  geom_point(size = 2) +
  labs(x = "year") +
  facet_grid(is.sep~trt.type) +
  theme_bw()

p2

# merge
p1 + p2 +
  labs(caption = "do lower NTs lead to larger pupal mass?") +
  plot_layout(guides = "collect",
              axes = "collect",
              widths = c(2:1)) &
  theme(legend.position = "top") &
  labs(#lty = "population",
       y = "mass (g)") &
  #guides(color = "none") &
  scale_linetype_manual(values = c("dashed", "solid")) &
  scale_shape_manual(values = aes_sex[[1]]) &
  scale_color_manual(values = aes_sex[[3]]) &
  #scale_fill_manual(values = c("#D95F02", "#7570B3")) &
  theme(strip.background.y = element_blank(), strip.text.y = element_blank())

```
- what does/doesnt matter?
  - pop, field < lab
  - minT, interacting with lab
  - sex can prob be ignored

## - stats

what affects pupal mass? Tmin, sex, year, pop?

(numbering is just based on when i ran them lol)

```{r}
# 01: test the full complex vs the full additive model
mod.pmass_int01 <- lm(mass.pupa ~ year*minT*pop*sex, data = ntw_expt.sex)
mod.pmass_add01 <- lm(mass.pupa ~ year + minT + pop + sex, data = ntw_expt.sex)

anova(mod.pmass_int01, mod.pmass_add01, test = "Chisq") # no sig diff btwn add/int: add is better
```
```{r}
# 02: look at int mod again after plotting the pupal masses by temp/sex/yr/pop. which ints matter?

# drop year
mod.pmass_int02 <- lm(mass.pupa ~ minT*pop*sex, data = ntw_expt.sex) 

anova(mod.pmass_int01, mod.pmass_int02, test = "Chisq") # temp*pop*sex is better

anova(mod.pmass_int02)

# drop sex
mod.pmass_int03 <- lm(mass.pupa ~ minT*pop, data = ntw_expt.sex) 

anova(mod.pmass_int02, mod.pmass_int03, test = "Chisq") # no sig diff, so keep sex?

# which terms matter?
anova(mod.pmass_int02)
```
- `mass.pupa ~ minT*pop*sex` seems good, with the following sig ints:
  - *** = minT; pop
  - * = sex, minT*pop

```{r}
# 03: look into the additive mods
mod.pmass_add02 <- lm(mass.pupa ~ minT + pop + sex, data = ntw_expt.sex)

anova(mod.pmass_int02, mod.pmass_add02, test = "Chisq") # no sig diff
```



# dmass

## - figs: check decrease

is decrease in mass from pup to ec proportional?

```{r}
ntw_wide %>%
  filter(!is.na(sex)) %>%
  filter(!(diet == "TB" & pop == "lab") #& trt.type == "expt"
         ) %>%
  ggplot(aes(y = mass.eclose, x = mass.pupa, 
             #lty = sex
             )) +
  geom_point(aes(color = minT, shape = trt.type), size = 2) +
  # geom_smooth(data = filter(ntw_wide, !(diet == "TB" & pop == "lab") & trt.type == "expt"),
  #             method = "lm",
  #             color = "red") +
  # annotate("text", label = "R^2 = 0.552", color = "red", x = 1100, y = 4500) +
  geom_smooth(data = filter(ntw_wide, !(diet == "TB" & pop == "lab") & trt.type == "ctrl"),
              method = "lm",
              color = "black") +
  annotate("text", label = "R^2 = 0.627 (26-26)", color = "black", x = 1100, y = 4250) +
  geom_smooth(method = "lm", color = "blue",
              #aes(lty = trt.type)
              ) +
  annotate("text", label = "R^2 = 0.731 (all)", color = "blue", x = 1100, y = 4000) +
  theme_bw() +
  scale_color_manual(values = aes_3col) +
  labs(caption = "mass pup vs mass eclosion") +
  xlim(c(500, 8100))

```

```{r}
summary(lm(mass.eclose ~ mass.pupa, data = filter(ntw_wide, !(diet == "TB" & pop == "lab") & trt.type == "expt")))$r.squared
# 0.5518755

summary(lm(mass.eclose ~ mass.pupa, data = filter(ntw_wide, !(diet == "TB" & pop == "lab") & trt.type == "ctrl")))$r.squared
# 0.6266585

summary(lm(mass.eclose ~ mass.pupa, data = filter(ntw_wide, !(diet == "TB" & pop == "lab"))))$r.squared
# 0.7310885
```

seems like yes (in both the ctrls and exptal bugs)

## - figs: by sex

```{r}
# separated sexes
p1 <- ss_moredev %>% 
  filter(sex != "both" & 
           trt.type == "expt") %>%
  ggplot(aes(y = avg.dmass, x = minT,
             shape = sex, color = sex,
             group = interaction(pop, sex)
             )) +
  geom_errorbar(aes(ymin = avg.dmass - se.dmass, ymax = avg.dmass + se.dmass), width = 0.25) +
  geom_line(aes(lty = pop), alpha = 1) +
  geom_point(size = 2) +
  geom_text(aes(label = n), hjust = -0.25, vjust = -0.5, show.legend = FALSE) +
  labs(x = "minimum temperature (¬∞C)") +
  facet_grid(sex~year) +
  #scale_color_manual(values = aes_2col) +
  theme_bw()

p1

p2 <- ss_moredev %>% 
  filter(sex != "both" & 
           trt.type == "ctrl") %>%
  ggplot(aes(y = avg.dmass, x = year,
             shape = sex, color = sex,
             group = interaction(pop, sex)
             )) +
  geom_errorbar(aes(ymin = avg.dmass - se.dmass, ymax = avg.dmass + se.dmass), width = 0.25) +
  geom_line(aes(lty = pop), alpha = 1) +
  geom_point(size = 2) +
  geom_text(aes(label = n), hjust = -0.25, vjust = -0.5, show.legend = FALSE) +
  labs(x = "year") +
  facet_grid(sex~trt.type) +
  #scale_color_manual(values = aes_2col) +
  theme_bw()

p2


p1 + p2 +
  labs(caption = "lower NTs x change in mass by sex") +
  plot_layout(guides = "collect",
              axes = "collect",
              widths = c(2:1)) &
  theme(legend.position = "top") &
  labs(#lty = "population",
       y = "mass pupa - mass eclosion (g)") &
  #guides(color = "none") &
  scale_linetype_manual(values = c("dashed", "solid")) &
  scale_color_manual(values = c("#D95F02", "#7570B3")) &
  theme(strip.background.y = element_blank(), strip.text.y = element_blank())
```

## - figs: both sexes

```{r}
# sexes combined
p1 <- ss_moredev %>% 
  filter(sex == "both" & 
           trt.type == "expt") %>%
  ggplot(aes(y = avg.dmass, x = minT,
             shape = sex, color = sex,
             group = interaction(pop, sex)
             )) +
  geom_errorbar(aes(ymin = avg.dmass - se.dmass, ymax = avg.dmass + se.dmass), width = 0.25) +
  geom_line(aes(lty = pop), alpha = 1) +
  geom_point(size = 2) +
  geom_text(aes(label = n), hjust = -0.25, vjust = -0.5, show.legend = FALSE) +
  labs(x = "minimum temperature (¬∞C)") +
  facet_grid(sex~year) +
  #scale_color_manual(values = aes_2col) +
  theme_bw()

p1

p2 <- ss_moredev %>% 
  filter(sex == "both" & 
           trt.type == "ctrl") %>%
  ggplot(aes(y = avg.dmass, x = year,
             shape = sex, color = sex,
             group = interaction(pop, sex)
             )) +
  geom_errorbar(aes(ymin = avg.dmass - se.dmass, ymax = avg.dmass + se.dmass), width = 0.25) +
  geom_line(aes(lty = pop)) +
  geom_point(size = 2) +
  geom_text(aes(label = n), hjust = -0.25, vjust = -0.5, show.legend = FALSE) +
  labs(x = "year") +
  facet_grid(~trt.type) +
  #scale_color_manual(values = aes_2col) +
  theme_bw()

p2


p1 + p2 +
  labs(caption = "lower NTs x change in mass") +
  plot_layout(guides = "collect",
              axes = "collect",
              widths = c(2:1)) &
  theme(legend.position = "top") &
  labs(#lty = "population",
       y = "mass pupa - mass eclosion (g)") &
  #guides(color = "none") &
  scale_linetype_manual(values = c("dashed", "solid")) &
  scale_color_manual(values = c("#D95F02", "#7570B3")) &
  theme(strip.background.y = element_blank(), strip.text.y = element_blank())
```

# pup growth rate 

## - figs: both sexes

```{r}
# sexes combined
p1 <- ss_moredev %>% 
  filter(sex == "both" & 
           trt.type == "expt") %>%
  ggplot(aes(y = avg.ratepup, x = minT,
             shape = sex, color = sex,
             group = interaction(pop, sex)
             )) +
  geom_errorbar(aes(ymin = avg.ratepup - se.ratepup, ymax = avg.ratepup + se.ratepup), width = 0.25) +
  geom_line(aes(lty = pop), alpha = 1) +
  geom_point(size = 2) +
  geom_text(aes(label = n), hjust = -0.25, vjust = -0.5, show.legend = FALSE) +
  labs(x = "minimum temperature (¬∞C)") +
  facet_grid(sex~year) +
  #scale_color_manual(values = aes_2col) +
  theme_bw()

p1

p2 <- ss_moredev %>% 
  filter(sex == "both" & 
           trt.type == "ctrl") %>%
  ggplot(aes(y = avg.ratepup, x = year,
             shape = sex, color = sex,
             group = interaction(pop, sex)
             )) +
  geom_errorbar(aes(ymin = avg.ratepup - se.ratepup, ymax = avg.ratepup + se.ratepup), width = 0.25) +
  geom_line(aes(lty = pop)) +
  geom_point(size = 2) +
  geom_text(aes(label = n), hjust = -0.25, vjust = -0.5, show.legend = FALSE) +
  labs(x = "year") +
  facet_grid(~trt.type) +
  #scale_color_manual(values = aes_2col) +
  theme_bw()

p2


p1 + p2 +
  labs(caption = "lower NTs x pup growth rate") +
  plot_layout(guides = "collect",
              axes = "collect",
              widths = c(2:1)) &
  theme(legend.position = "top") &
  labs(#lty = "population",
       y = "pup growth rate (g/days)") &
  #guides(color = "none") &
  scale_linetype_manual(values = c("dashed", "solid")) &
  scale_color_manual(values = c("#D95F02", "#7570B3")) &
  theme(strip.background.y = element_blank(), strip.text.y = element_blank())
```



## - figs: both sexes (log)

```{r}
# sexes combined
p1 <- ss_moredev %>% 
  filter(sex == "both" & 
           trt.type == "expt") %>%
  ggplot(aes(y = avg.ratepupl, x = minT,
             shape = sex, color = sex,
             group = interaction(pop, sex)
             )) +
  geom_errorbar(aes(ymin = avg.ratepupl - se.ratepupl, ymax = avg.ratepupl + se.ratepupl), width = 0.25) +
  geom_line(aes(lty = pop), alpha = 1) +
  geom_point(size = 2) +
  geom_text(aes(label = n), hjust = -0.25, vjust = -0.5, show.legend = FALSE) +
  labs(x = "minimum temperature (¬∞C)") +
  facet_grid(sex~year) +
  #scale_color_manual(values = aes_2col) +
  theme_bw()

p1

p2 <- ss_moredev %>% 
  filter(sex == "both" & 
           trt.type == "ctrl") %>%
  ggplot(aes(y = avg.ratepupl, x = year,
             shape = sex, color = sex,
             group = interaction(pop, sex)
             )) +
  geom_errorbar(aes(ymin = avg.ratepupl - se.ratepupl, ymax = avg.ratepupl + se.ratepupl), width = 0.25) +
  geom_line(aes(lty = pop)) +
  geom_point(size = 2) +
  geom_text(aes(label = n), hjust = -0.25, vjust = -0.5, show.legend = FALSE) +
  labs(x = "year") +
  facet_grid(~trt.type) +
  #scale_color_manual(values = aes_2col) +
  theme_bw()

p2


p1 + p2 +
  labs(caption = "lower NTs x pup growth rate (log)") +
  plot_layout(guides = "collect",
              axes = "collect",
              widths = c(2:1)) &
  theme(legend.position = "top") &
  labs(#lty = "population",
       y = "pup growth rate (log mg/days)") &
  #guides(color = "none") &
  scale_linetype_manual(values = c("dashed", "solid")) &
  scale_color_manual(values = c("#D95F02", "#7570B3")) &
  theme(strip.background.y = element_blank(), strip.text.y = element_blank())
```




